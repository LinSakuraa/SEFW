{"ast":null,"code":"import { h, defineComponent, Fragment, ref, withDirectives, Transition, vShow, watch, computed, toRef, onBeforeUnmount } from 'vue';\nimport { zindexable } from 'vdirs';\nimport { useIsMounted } from 'vooks';\nimport { LazyTeleport } from 'vueuc';\nimport { on, off } from 'evtd';\nimport { beforeNextFrameOnce } from 'seemly';\nimport { RotateClockwiseIcon, RotateCounterclockwiseIcon, ZoomInIcon, ZoomOutIcon } from '../../_internal/icons';\nimport { useConfig, useLocale, useTheme, useThemeClass } from '../../_mixins';\nimport { NBaseIcon } from '../../_internal';\nimport { NTooltip } from '../../tooltip';\nimport { imageLight } from '../styles';\nimport { prevIcon, nextIcon, closeIcon } from './icons';\nimport { imagePreviewSharedProps } from './interface';\nimport style from './styles/index.cssr';\nexport default defineComponent({\n  name: 'ImagePreview',\n  props: Object.assign(Object.assign({}, imagePreviewSharedProps), {\n    onNext: Function,\n    onPrev: Function,\n    clsPrefix: {\n      type: String,\n      required: true\n    }\n  }),\n\n  setup(props) {\n    const themeRef = useTheme('Image', '-image', style, imageLight, props, toRef(props, 'clsPrefix'));\n    let thumbnailEl = null;\n    const previewRef = ref(null);\n    const previewWrapperRef = ref(null);\n    const previewSrcRef = ref(undefined);\n    const showRef = ref(false);\n    const displayedRef = ref(false);\n    const {\n      localeRef\n    } = useLocale('Image');\n\n    function syncTransformOrigin() {\n      const {\n        value: previewWrapper\n      } = previewWrapperRef;\n      if (!thumbnailEl || !previewWrapper) return;\n      const {\n        style\n      } = previewWrapper;\n      const tbox = thumbnailEl.getBoundingClientRect();\n      const tx = tbox.left + tbox.width / 2;\n      const ty = tbox.top + tbox.height / 2;\n      style.transformOrigin = `${tx}px ${ty}px`;\n    }\n\n    function handleKeydown(e) {\n      var _a, _b;\n\n      switch (e.code) {\n        case 'ArrowLeft':\n          (_a = props.onPrev) === null || _a === void 0 ? void 0 : _a.call(props);\n          break;\n\n        case 'ArrowRight':\n          (_b = props.onNext) === null || _b === void 0 ? void 0 : _b.call(props);\n          break;\n\n        case 'Escape':\n          toggleShow();\n          break;\n      }\n    }\n\n    watch(showRef, value => {\n      if (value) on('keydown', document, handleKeydown);else off('keydown', document, handleKeydown);\n    });\n    onBeforeUnmount(() => {\n      off('keydown', document, handleKeydown);\n    });\n    let startX = 0;\n    let startY = 0;\n    let offsetX = 0;\n    let offsetY = 0;\n    let startOffsetX = 0;\n    let startOffsetY = 0;\n    let mouseDownClientX = 0;\n    let mouseDownClientY = 0;\n    let dragging = false;\n\n    function handleMouseMove(e) {\n      const {\n        clientX,\n        clientY\n      } = e;\n      offsetX = clientX - startX;\n      offsetY = clientY - startY;\n      beforeNextFrameOnce(derivePreviewStyle);\n    }\n\n    function getMoveStrategy(opts) {\n      const {\n        mouseUpClientX,\n        mouseUpClientY,\n        mouseDownClientX,\n        mouseDownClientY\n      } = opts;\n      const deltaHorizontal = mouseDownClientX - mouseUpClientX;\n      const deltaVertical = mouseDownClientY - mouseUpClientY;\n      const moveVerticalDirection = `vertical${deltaVertical > 0 ? 'Top' : 'Bottom'}`;\n      const moveHorizontalDirection = `horizontal${deltaHorizontal > 0 ? 'Left' : 'Right'}`;\n      return {\n        moveVerticalDirection,\n        moveHorizontalDirection,\n        deltaHorizontal,\n        deltaVertical\n      };\n    } // avoid image move outside viewport\n\n\n    function getDerivedOffset(moveStrategy) {\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return {\n        offsetX: 0,\n        offsetY: 0\n      };\n      const pbox = preview.getBoundingClientRect();\n      const {\n        moveVerticalDirection,\n        moveHorizontalDirection,\n        deltaHorizontal,\n        deltaVertical\n      } = moveStrategy || {};\n      let nextOffsetX = 0;\n      let nextOffsetY = 0;\n\n      if (pbox.width <= window.innerWidth) {\n        nextOffsetX = 0;\n      } else if (pbox.left > 0) {\n        nextOffsetX = (pbox.width - window.innerWidth) / 2;\n      } else if (pbox.right < window.innerWidth) {\n        nextOffsetX = -(pbox.width - window.innerWidth) / 2;\n      } else if (moveHorizontalDirection === 'horizontalRight') {\n        nextOffsetX = Math.min((pbox.width - window.innerWidth) / 2, startOffsetX - (deltaHorizontal !== null && deltaHorizontal !== void 0 ? deltaHorizontal : 0));\n      } else {\n        nextOffsetX = Math.max(-((pbox.width - window.innerWidth) / 2), startOffsetX - (deltaHorizontal !== null && deltaHorizontal !== void 0 ? deltaHorizontal : 0));\n      }\n\n      if (pbox.height <= window.innerHeight) {\n        nextOffsetY = 0;\n      } else if (pbox.top > 0) {\n        nextOffsetY = (pbox.height - window.innerHeight) / 2;\n      } else if (pbox.bottom < window.innerHeight) {\n        nextOffsetY = -(pbox.height - window.innerHeight) / 2;\n      } else if (moveVerticalDirection === 'verticalBottom') {\n        nextOffsetY = Math.min((pbox.height - window.innerHeight) / 2, startOffsetY - (deltaVertical !== null && deltaVertical !== void 0 ? deltaVertical : 0));\n      } else {\n        nextOffsetY = Math.max(-((pbox.height - window.innerHeight) / 2), startOffsetY - (deltaVertical !== null && deltaVertical !== void 0 ? deltaVertical : 0));\n      }\n\n      return {\n        offsetX: nextOffsetX,\n        offsetY: nextOffsetY\n      };\n    }\n\n    function handleMouseUp(e) {\n      off('mousemove', document, handleMouseMove);\n      off('mouseup', document, handleMouseUp);\n      const {\n        clientX: mouseUpClientX,\n        clientY: mouseUpClientY\n      } = e;\n      dragging = false;\n      const moveStrategy = getMoveStrategy({\n        mouseUpClientX,\n        mouseUpClientY,\n        mouseDownClientX,\n        mouseDownClientY\n      });\n      const offset = getDerivedOffset(moveStrategy);\n      offsetX = offset.offsetX;\n      offsetY = offset.offsetY;\n      derivePreviewStyle();\n    }\n\n    function handlePreviewMousedown(e) {\n      const {\n        clientX,\n        clientY\n      } = e;\n      dragging = true;\n      startX = clientX - offsetX;\n      startY = clientY - offsetY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n      mouseDownClientX = clientX;\n      mouseDownClientY = clientY;\n      derivePreviewStyle();\n      on('mousemove', document, handleMouseMove);\n      on('mouseup', document, handleMouseUp);\n    }\n\n    function handlePreviewDblclick() {\n      scale = scale === 1 ? 2 : 1;\n      derivePreviewStyle();\n    }\n\n    let scale = 1;\n    let rotate = 0;\n\n    function handleSwitchPrev() {\n      var _a;\n\n      scale = 1;\n      rotate = 0;\n      (_a = props.onPrev) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n\n    function handleSwitchNext() {\n      var _a;\n\n      scale = 1;\n      rotate = 0;\n      (_a = props.onNext) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n\n    function rotateCounterclockwise() {\n      rotate -= 90;\n      derivePreviewStyle();\n    }\n\n    function rotateClockwise() {\n      rotate += 90;\n      derivePreviewStyle();\n    }\n\n    function zoomIn() {\n      if (scale < 3) {\n        scale += 0.5;\n        derivePreviewStyle();\n      }\n    }\n\n    function zoomOut() {\n      if (scale > 0.5) {\n        scale -= 0.5;\n        derivePreviewStyle(false);\n        const offset = getDerivedOffset();\n        scale += 0.5;\n        derivePreviewStyle(false);\n        scale -= 0.5;\n        offsetX = offset.offsetX;\n        offsetY = offset.offsetY;\n        derivePreviewStyle();\n      }\n    }\n\n    function derivePreviewStyle(transition = true) {\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return;\n      const {\n        style\n      } = preview;\n      const transformStyle = `transform-origin: center; transform: translateX(${offsetX}px) translateY(${offsetY}px) rotate(${rotate}deg) scale(${scale});`;\n\n      if (dragging) {\n        style.cssText = 'cursor: grabbing; transition: none;' + transformStyle;\n      } else {\n        style.cssText = 'cursor: grab;' + transformStyle + (transition ? '' : 'transition: none;');\n      }\n\n      if (!transition) {\n        void preview.offsetHeight;\n      }\n    }\n\n    function toggleShow() {\n      showRef.value = !showRef.value;\n      displayedRef.value = true;\n    }\n\n    const exposedMethods = {\n      setPreviewSrc: src => {\n        previewSrcRef.value = src;\n      },\n      setThumbnailEl: el => {\n        thumbnailEl = el;\n      },\n      toggleShow\n    };\n\n    function withTooltip(node, tooltipKey) {\n      if (props.showToolbarTooltip) {\n        const {\n          value: theme\n        } = themeRef;\n        return h(NTooltip, {\n          to: false,\n          theme: theme.peers.Tooltip,\n          themeOverrides: theme.peerOverrides.Tooltip\n        }, {\n          default: () => {\n            return localeRef.value[tooltipKey];\n          },\n          trigger: () => node\n        });\n      } else {\n        return node;\n      }\n    }\n\n    const cssVarsRef = computed(() => {\n      const {\n        common: {\n          cubicBezierEaseInOut\n        },\n        self: {\n          toolbarIconColor,\n          toolbarBorderRadius,\n          toolbarBoxShadow,\n          toolbarColor\n        }\n      } = themeRef.value;\n      return {\n        '--n-bezier': cubicBezierEaseInOut,\n        '--n-toolbar-icon-color': toolbarIconColor,\n        '--n-toolbar-color': toolbarColor,\n        '--n-toolbar-border-radius': toolbarBorderRadius,\n        '--n-toolbar-box-shadow': toolbarBoxShadow\n      };\n    });\n    const {\n      inlineThemeDisabled\n    } = useConfig();\n    const themeClassHandle = inlineThemeDisabled ? useThemeClass('image-preview', undefined, cssVarsRef, props) : undefined;\n    return Object.assign({\n      previewRef,\n      previewWrapperRef,\n      previewSrc: previewSrcRef,\n      show: showRef,\n      appear: useIsMounted(),\n      displayed: displayedRef,\n\n      handleWheel(e) {\n        e.preventDefault();\n      },\n\n      handlePreviewMousedown,\n      handlePreviewDblclick,\n      syncTransformOrigin,\n      handleAfterLeave: () => {\n        rotate = 0;\n        scale = 1;\n        displayedRef.value = false;\n      },\n      handleDragStart: e => {\n        e.preventDefault();\n      },\n      zoomIn,\n      zoomOut,\n      rotateCounterclockwise,\n      rotateClockwise,\n      handleSwitchPrev,\n      handleSwitchNext,\n      withTooltip,\n      cssVars: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender\n    }, exposedMethods);\n  },\n\n  render() {\n    var _a, _b;\n\n    const {\n      clsPrefix\n    } = this;\n    return h(Fragment, null, (_b = (_a = this.$slots).default) === null || _b === void 0 ? void 0 : _b.call(_a), h(LazyTeleport, {\n      show: this.show\n    }, {\n      default: () => {\n        var _a;\n\n        if (!(this.show || this.displayed)) {\n          return null;\n        }\n\n        (_a = this.onRender) === null || _a === void 0 ? void 0 : _a.call(this);\n        return withDirectives(h(\"div\", {\n          class: [`${clsPrefix}-image-preview-container`, this.themeClass],\n          style: this.cssVars,\n          onWheel: this.handleWheel\n        }, h(Transition, {\n          name: \"fade-in-transition\",\n          appear: this.appear\n        }, {\n          default: () => this.show ? h(\"div\", {\n            class: `${clsPrefix}-image-preview-overlay`,\n            onClick: this.toggleShow\n          }) : null\n        }), this.showToolbar ? h(Transition, {\n          name: \"fade-in-transition\",\n          appear: this.appear\n        }, {\n          default: () => {\n            if (!this.show) return null;\n            const {\n              withTooltip\n            } = this;\n            return h(\"div\", {\n              class: `${clsPrefix}-image-preview-toolbar`\n            }, this.onPrev ? h(Fragment, null, withTooltip(h(NBaseIcon, {\n              clsPrefix: clsPrefix,\n              onClick: this.handleSwitchPrev\n            }, {\n              default: () => prevIcon\n            }), 'tipPrevious'), withTooltip(h(NBaseIcon, {\n              clsPrefix: clsPrefix,\n              onClick: this.handleSwitchNext\n            }, {\n              default: () => nextIcon\n            }), 'tipNext')) : null, withTooltip(h(NBaseIcon, {\n              clsPrefix: clsPrefix,\n              onClick: this.rotateCounterclockwise\n            }, {\n              default: () => h(RotateCounterclockwiseIcon, null)\n            }), 'tipCounterclockwise'), withTooltip(h(NBaseIcon, {\n              clsPrefix: clsPrefix,\n              onClick: this.rotateClockwise\n            }, {\n              default: () => h(RotateClockwiseIcon, null)\n            }), 'tipClockwise'), withTooltip(h(NBaseIcon, {\n              clsPrefix: clsPrefix,\n              onClick: this.zoomOut\n            }, {\n              default: () => h(ZoomOutIcon, null)\n            }), 'tipZoomOut'), withTooltip(h(NBaseIcon, {\n              clsPrefix: clsPrefix,\n              onClick: this.zoomIn\n            }, {\n              default: () => h(ZoomInIcon, null)\n            }), 'tipZoomIn'), withTooltip(h(NBaseIcon, {\n              clsPrefix: clsPrefix,\n              onClick: this.toggleShow\n            }, {\n              default: () => closeIcon\n            }), 'tipClose'));\n          }\n        }) : null, h(Transition, {\n          name: \"fade-in-scale-up-transition\",\n          onAfterLeave: this.handleAfterLeave,\n          appear: this.appear,\n          // BUG:\n          // onEnter will be called twice, I don't know why\n          // Maybe it is a bug of vue\n          onEnter: this.syncTransformOrigin,\n          onBeforeLeave: this.syncTransformOrigin\n        }, {\n          default: () => withDirectives(h(\"div\", {\n            class: `${clsPrefix}-image-preview-wrapper`,\n            ref: \"previewWrapperRef\"\n          }, h(\"img\", {\n            draggable: false,\n            onMousedown: this.handlePreviewMousedown,\n            onDblclick: this.handlePreviewDblclick,\n            class: `${clsPrefix}-image-preview`,\n            key: this.previewSrc,\n            src: this.previewSrc,\n            ref: \"previewRef\",\n            onDragstart: this.handleDragStart\n          })), [[vShow, this.show]])\n        })), [[zindexable, {\n          enabled: this.show\n        }]]);\n      }\n    }));\n  }\n\n});","map":{"version":3,"sources":["G:/VUE_FDS/fluent-vue/node_modules/naive-ui/es/image/src/ImagePreview.js"],"names":["h","defineComponent","Fragment","ref","withDirectives","Transition","vShow","watch","computed","toRef","onBeforeUnmount","zindexable","useIsMounted","LazyTeleport","on","off","beforeNextFrameOnce","RotateClockwiseIcon","RotateCounterclockwiseIcon","ZoomInIcon","ZoomOutIcon","useConfig","useLocale","useTheme","useThemeClass","NBaseIcon","NTooltip","imageLight","prevIcon","nextIcon","closeIcon","imagePreviewSharedProps","style","name","props","Object","assign","onNext","Function","onPrev","clsPrefix","type","String","required","setup","themeRef","thumbnailEl","previewRef","previewWrapperRef","previewSrcRef","undefined","showRef","displayedRef","localeRef","syncTransformOrigin","value","previewWrapper","tbox","getBoundingClientRect","tx","left","width","ty","top","height","transformOrigin","handleKeydown","e","_a","_b","code","call","toggleShow","document","startX","startY","offsetX","offsetY","startOffsetX","startOffsetY","mouseDownClientX","mouseDownClientY","dragging","handleMouseMove","clientX","clientY","derivePreviewStyle","getMoveStrategy","opts","mouseUpClientX","mouseUpClientY","deltaHorizontal","deltaVertical","moveVerticalDirection","moveHorizontalDirection","getDerivedOffset","moveStrategy","preview","pbox","nextOffsetX","nextOffsetY","window","innerWidth","right","Math","min","max","innerHeight","bottom","handleMouseUp","offset","handlePreviewMousedown","handlePreviewDblclick","scale","rotate","handleSwitchPrev","handleSwitchNext","rotateCounterclockwise","rotateClockwise","zoomIn","zoomOut","transition","transformStyle","cssText","offsetHeight","exposedMethods","setPreviewSrc","src","setThumbnailEl","el","withTooltip","node","tooltipKey","showToolbarTooltip","theme","to","peers","Tooltip","themeOverrides","peerOverrides","default","trigger","cssVarsRef","common","cubicBezierEaseInOut","self","toolbarIconColor","toolbarBorderRadius","toolbarBoxShadow","toolbarColor","inlineThemeDisabled","themeClassHandle","previewSrc","show","appear","displayed","handleWheel","preventDefault","handleAfterLeave","handleDragStart","cssVars","themeClass","onRender","render","$slots","class","onWheel","onClick","showToolbar","onAfterLeave","onEnter","onBeforeLeave","draggable","onMousedown","onDblclick","key","onDragstart","enabled"],"mappings":"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","sourcesContent":["import { h, defineComponent, Fragment, ref, withDirectives, Transition, vShow, watch, computed, toRef, onBeforeUnmount } from 'vue';\nimport { zindexable } from 'vdirs';\nimport { useIsMounted } from 'vooks';\nimport { LazyTeleport } from 'vueuc';\nimport { on, off } from 'evtd';\nimport { beforeNextFrameOnce } from 'seemly';\nimport { RotateClockwiseIcon, RotateCounterclockwiseIcon, ZoomInIcon, ZoomOutIcon } from '../../_internal/icons';\nimport { useConfig, useLocale, useTheme, useThemeClass } from '../../_mixins';\nimport { NBaseIcon } from '../../_internal';\nimport { NTooltip } from '../../tooltip';\nimport { imageLight } from '../styles';\nimport { prevIcon, nextIcon, closeIcon } from './icons';\nimport { imagePreviewSharedProps } from './interface';\nimport style from './styles/index.cssr';\nexport default defineComponent({\n    name: 'ImagePreview',\n    props: Object.assign(Object.assign({}, imagePreviewSharedProps), { onNext: Function, onPrev: Function, clsPrefix: {\n            type: String,\n            required: true\n        } }),\n    setup(props) {\n        const themeRef = useTheme('Image', '-image', style, imageLight, props, toRef(props, 'clsPrefix'));\n        let thumbnailEl = null;\n        const previewRef = ref(null);\n        const previewWrapperRef = ref(null);\n        const previewSrcRef = ref(undefined);\n        const showRef = ref(false);\n        const displayedRef = ref(false);\n        const { localeRef } = useLocale('Image');\n        function syncTransformOrigin() {\n            const { value: previewWrapper } = previewWrapperRef;\n            if (!thumbnailEl || !previewWrapper)\n                return;\n            const { style } = previewWrapper;\n            const tbox = thumbnailEl.getBoundingClientRect();\n            const tx = tbox.left + tbox.width / 2;\n            const ty = tbox.top + tbox.height / 2;\n            style.transformOrigin = `${tx}px ${ty}px`;\n        }\n        function handleKeydown(e) {\n            var _a, _b;\n            switch (e.code) {\n                case 'ArrowLeft':\n                    (_a = props.onPrev) === null || _a === void 0 ? void 0 : _a.call(props);\n                    break;\n                case 'ArrowRight':\n                    (_b = props.onNext) === null || _b === void 0 ? void 0 : _b.call(props);\n                    break;\n                case 'Escape':\n                    toggleShow();\n                    break;\n            }\n        }\n        watch(showRef, (value) => {\n            if (value)\n                on('keydown', document, handleKeydown);\n            else\n                off('keydown', document, handleKeydown);\n        });\n        onBeforeUnmount(() => {\n            off('keydown', document, handleKeydown);\n        });\n        let startX = 0;\n        let startY = 0;\n        let offsetX = 0;\n        let offsetY = 0;\n        let startOffsetX = 0;\n        let startOffsetY = 0;\n        let mouseDownClientX = 0;\n        let mouseDownClientY = 0;\n        let dragging = false;\n        function handleMouseMove(e) {\n            const { clientX, clientY } = e;\n            offsetX = clientX - startX;\n            offsetY = clientY - startY;\n            beforeNextFrameOnce(derivePreviewStyle);\n        }\n        function getMoveStrategy(opts) {\n            const { mouseUpClientX, mouseUpClientY, mouseDownClientX, mouseDownClientY } = opts;\n            const deltaHorizontal = mouseDownClientX - mouseUpClientX;\n            const deltaVertical = mouseDownClientY - mouseUpClientY;\n            const moveVerticalDirection = `vertical${deltaVertical > 0 ? 'Top' : 'Bottom'}`;\n            const moveHorizontalDirection = `horizontal${deltaHorizontal > 0 ? 'Left' : 'Right'}`;\n            return {\n                moveVerticalDirection,\n                moveHorizontalDirection,\n                deltaHorizontal,\n                deltaVertical\n            };\n        }\n        // avoid image move outside viewport\n        function getDerivedOffset(moveStrategy) {\n            const { value: preview } = previewRef;\n            if (!preview)\n                return { offsetX: 0, offsetY: 0 };\n            const pbox = preview.getBoundingClientRect();\n            const { moveVerticalDirection, moveHorizontalDirection, deltaHorizontal, deltaVertical } = moveStrategy || {};\n            let nextOffsetX = 0;\n            let nextOffsetY = 0;\n            if (pbox.width <= window.innerWidth) {\n                nextOffsetX = 0;\n            }\n            else if (pbox.left > 0) {\n                nextOffsetX = (pbox.width - window.innerWidth) / 2;\n            }\n            else if (pbox.right < window.innerWidth) {\n                nextOffsetX = -(pbox.width - window.innerWidth) / 2;\n            }\n            else if (moveHorizontalDirection === 'horizontalRight') {\n                nextOffsetX = Math.min((pbox.width - window.innerWidth) / 2, startOffsetX - (deltaHorizontal !== null && deltaHorizontal !== void 0 ? deltaHorizontal : 0));\n            }\n            else {\n                nextOffsetX = Math.max(-((pbox.width - window.innerWidth) / 2), startOffsetX - (deltaHorizontal !== null && deltaHorizontal !== void 0 ? deltaHorizontal : 0));\n            }\n            if (pbox.height <= window.innerHeight) {\n                nextOffsetY = 0;\n            }\n            else if (pbox.top > 0) {\n                nextOffsetY = (pbox.height - window.innerHeight) / 2;\n            }\n            else if (pbox.bottom < window.innerHeight) {\n                nextOffsetY = -(pbox.height - window.innerHeight) / 2;\n            }\n            else if (moveVerticalDirection === 'verticalBottom') {\n                nextOffsetY = Math.min((pbox.height - window.innerHeight) / 2, startOffsetY - (deltaVertical !== null && deltaVertical !== void 0 ? deltaVertical : 0));\n            }\n            else {\n                nextOffsetY = Math.max(-((pbox.height - window.innerHeight) / 2), startOffsetY - (deltaVertical !== null && deltaVertical !== void 0 ? deltaVertical : 0));\n            }\n            return {\n                offsetX: nextOffsetX,\n                offsetY: nextOffsetY\n            };\n        }\n        function handleMouseUp(e) {\n            off('mousemove', document, handleMouseMove);\n            off('mouseup', document, handleMouseUp);\n            const { clientX: mouseUpClientX, clientY: mouseUpClientY } = e;\n            dragging = false;\n            const moveStrategy = getMoveStrategy({\n                mouseUpClientX,\n                mouseUpClientY,\n                mouseDownClientX,\n                mouseDownClientY\n            });\n            const offset = getDerivedOffset(moveStrategy);\n            offsetX = offset.offsetX;\n            offsetY = offset.offsetY;\n            derivePreviewStyle();\n        }\n        function handlePreviewMousedown(e) {\n            const { clientX, clientY } = e;\n            dragging = true;\n            startX = clientX - offsetX;\n            startY = clientY - offsetY;\n            startOffsetX = offsetX;\n            startOffsetY = offsetY;\n            mouseDownClientX = clientX;\n            mouseDownClientY = clientY;\n            derivePreviewStyle();\n            on('mousemove', document, handleMouseMove);\n            on('mouseup', document, handleMouseUp);\n        }\n        function handlePreviewDblclick() {\n            scale = scale === 1 ? 2 : 1;\n            derivePreviewStyle();\n        }\n        let scale = 1;\n        let rotate = 0;\n        function handleSwitchPrev() {\n            var _a;\n            scale = 1;\n            rotate = 0;\n            (_a = props.onPrev) === null || _a === void 0 ? void 0 : _a.call(props);\n        }\n        function handleSwitchNext() {\n            var _a;\n            scale = 1;\n            rotate = 0;\n            (_a = props.onNext) === null || _a === void 0 ? void 0 : _a.call(props);\n        }\n        function rotateCounterclockwise() {\n            rotate -= 90;\n            derivePreviewStyle();\n        }\n        function rotateClockwise() {\n            rotate += 90;\n            derivePreviewStyle();\n        }\n        function zoomIn() {\n            if (scale < 3) {\n                scale += 0.5;\n                derivePreviewStyle();\n            }\n        }\n        function zoomOut() {\n            if (scale > 0.5) {\n                scale -= 0.5;\n                derivePreviewStyle(false);\n                const offset = getDerivedOffset();\n                scale += 0.5;\n                derivePreviewStyle(false);\n                scale -= 0.5;\n                offsetX = offset.offsetX;\n                offsetY = offset.offsetY;\n                derivePreviewStyle();\n            }\n        }\n        function derivePreviewStyle(transition = true) {\n            const { value: preview } = previewRef;\n            if (!preview)\n                return;\n            const { style } = preview;\n            const transformStyle = `transform-origin: center; transform: translateX(${offsetX}px) translateY(${offsetY}px) rotate(${rotate}deg) scale(${scale});`;\n            if (dragging) {\n                style.cssText = 'cursor: grabbing; transition: none;' + transformStyle;\n            }\n            else {\n                style.cssText =\n                    'cursor: grab;' +\n                        transformStyle +\n                        (transition ? '' : 'transition: none;');\n            }\n            if (!transition) {\n                void preview.offsetHeight;\n            }\n        }\n        function toggleShow() {\n            showRef.value = !showRef.value;\n            displayedRef.value = true;\n        }\n        const exposedMethods = {\n            setPreviewSrc: (src) => {\n                previewSrcRef.value = src;\n            },\n            setThumbnailEl: (el) => {\n                thumbnailEl = el;\n            },\n            toggleShow\n        };\n        function withTooltip(node, tooltipKey) {\n            if (props.showToolbarTooltip) {\n                const { value: theme } = themeRef;\n                return (h(NTooltip, { to: false, theme: theme.peers.Tooltip, themeOverrides: theme.peerOverrides.Tooltip }, {\n                    default: () => {\n                        return localeRef.value[tooltipKey];\n                    },\n                    trigger: () => node\n                }));\n            }\n            else {\n                return node;\n            }\n        }\n        const cssVarsRef = computed(() => {\n            const { common: { cubicBezierEaseInOut }, self: { toolbarIconColor, toolbarBorderRadius, toolbarBoxShadow, toolbarColor } } = themeRef.value;\n            return {\n                '--n-bezier': cubicBezierEaseInOut,\n                '--n-toolbar-icon-color': toolbarIconColor,\n                '--n-toolbar-color': toolbarColor,\n                '--n-toolbar-border-radius': toolbarBorderRadius,\n                '--n-toolbar-box-shadow': toolbarBoxShadow\n            };\n        });\n        const { inlineThemeDisabled } = useConfig();\n        const themeClassHandle = inlineThemeDisabled\n            ? useThemeClass('image-preview', undefined, cssVarsRef, props)\n            : undefined;\n        return Object.assign({ previewRef,\n            previewWrapperRef, previewSrc: previewSrcRef, show: showRef, appear: useIsMounted(), displayed: displayedRef, handleWheel(e) {\n                e.preventDefault();\n            },\n            handlePreviewMousedown,\n            handlePreviewDblclick,\n            syncTransformOrigin, handleAfterLeave: () => {\n                rotate = 0;\n                scale = 1;\n                displayedRef.value = false;\n            }, handleDragStart: (e) => {\n                e.preventDefault();\n            }, zoomIn,\n            zoomOut,\n            rotateCounterclockwise,\n            rotateClockwise,\n            handleSwitchPrev,\n            handleSwitchNext,\n            withTooltip, cssVars: inlineThemeDisabled ? undefined : cssVarsRef, themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass, onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender }, exposedMethods);\n    },\n    render() {\n        var _a, _b;\n        const { clsPrefix } = this;\n        return (h(Fragment, null, (_b = (_a = this.$slots).default) === null || _b === void 0 ? void 0 :\n            _b.call(_a),\n            h(LazyTeleport, { show: this.show }, {\n                default: () => {\n                    var _a;\n                    if (!(this.show || this.displayed)) {\n                        return null;\n                    }\n                    (_a = this.onRender) === null || _a === void 0 ? void 0 : _a.call(this);\n                    return withDirectives(h(\"div\", { class: [\n                            `${clsPrefix}-image-preview-container`,\n                            this.themeClass\n                        ], style: this.cssVars, onWheel: this.handleWheel },\n                        h(Transition, { name: \"fade-in-transition\", appear: this.appear }, {\n                            default: () => this.show ? (h(\"div\", { class: `${clsPrefix}-image-preview-overlay`, onClick: this.toggleShow })) : null\n                        }),\n                        this.showToolbar ? (h(Transition, { name: \"fade-in-transition\", appear: this.appear }, {\n                            default: () => {\n                                if (!this.show)\n                                    return null;\n                                const { withTooltip } = this;\n                                return (h(\"div\", { class: `${clsPrefix}-image-preview-toolbar` },\n                                    this.onPrev ? (h(Fragment, null,\n                                        withTooltip(h(NBaseIcon, { clsPrefix: clsPrefix, onClick: this.handleSwitchPrev }, { default: () => prevIcon }), 'tipPrevious'),\n                                        withTooltip(h(NBaseIcon, { clsPrefix: clsPrefix, onClick: this.handleSwitchNext }, { default: () => nextIcon }), 'tipNext'))) : null,\n                                    withTooltip(h(NBaseIcon, { clsPrefix: clsPrefix, onClick: this.rotateCounterclockwise }, {\n                                        default: () => (h(RotateCounterclockwiseIcon, null))\n                                    }), 'tipCounterclockwise'),\n                                    withTooltip(h(NBaseIcon, { clsPrefix: clsPrefix, onClick: this.rotateClockwise }, {\n                                        default: () => h(RotateClockwiseIcon, null)\n                                    }), 'tipClockwise'),\n                                    withTooltip(h(NBaseIcon, { clsPrefix: clsPrefix, onClick: this.zoomOut }, { default: () => h(ZoomOutIcon, null) }), 'tipZoomOut'),\n                                    withTooltip(h(NBaseIcon, { clsPrefix: clsPrefix, onClick: this.zoomIn }, { default: () => h(ZoomInIcon, null) }), 'tipZoomIn'),\n                                    withTooltip(h(NBaseIcon, { clsPrefix: clsPrefix, onClick: this.toggleShow }, { default: () => closeIcon }), 'tipClose')));\n                            }\n                        })) : null,\n                        h(Transition, { name: \"fade-in-scale-up-transition\", onAfterLeave: this.handleAfterLeave, appear: this.appear, \n                            // BUG:\n                            // onEnter will be called twice, I don't know why\n                            // Maybe it is a bug of vue\n                            onEnter: this.syncTransformOrigin, onBeforeLeave: this.syncTransformOrigin }, {\n                            default: () => withDirectives(h(\"div\", { class: `${clsPrefix}-image-preview-wrapper`, ref: \"previewWrapperRef\" },\n                                h(\"img\", { draggable: false, onMousedown: this.handlePreviewMousedown, onDblclick: this.handlePreviewDblclick, class: `${clsPrefix}-image-preview`, key: this.previewSrc, src: this.previewSrc, ref: \"previewRef\", onDragstart: this.handleDragStart })), [[vShow, this.show]])\n                        })), [[zindexable, { enabled: this.show }]]);\n                }\n            })));\n    }\n});\n"]},"metadata":{},"sourceType":"module"}