{"ast":null,"code":"import { h, computed, inject, ref, Transition, defineComponent, provide, mergeProps } from 'vue';\nimport { VBinder, VTarget, VFollower } from 'vueuc';\nimport { useMemo } from 'vooks';\nimport { ChevronRightIcon } from '../../_internal/icons';\nimport { render, useDeferredTrue } from '../../_utils';\nimport { NIcon } from '../../icon'; // eslint-disable-next-line import/no-cycle\n\nimport NDropdownMenu from './DropdownMenu';\nimport { dropdownMenuInjectionKey, dropdownInjectionKey, dropdownOptionInjectionKey } from './context';\nimport { isSubmenuNode } from './utils';\nimport { happensIn } from 'seemly';\nexport default defineComponent({\n  name: 'DropdownOption',\n  props: {\n    clsPrefix: {\n      type: String,\n      required: true\n    },\n    tmNode: {\n      type: Object,\n      required: true\n    },\n    parentKey: {\n      type: [String, Number],\n      default: null\n    },\n    placement: {\n      type: String,\n      default: 'right-start'\n    },\n    props: Object\n  },\n\n  setup(props) {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const NDropdown = inject(dropdownInjectionKey);\n    const {\n      hoverKeyRef,\n      keyboardKeyRef,\n      lastToggledSubmenuKeyRef,\n      pendingKeyPathRef,\n      activeKeyPathRef,\n      animatedRef,\n      mergedShowRef,\n      renderLabelRef,\n      renderIconRef,\n      labelFieldRef,\n      childrenFieldRef\n    } = NDropdown;\n    const NDropdownOption = inject(dropdownOptionInjectionKey, null); // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\n    const NDropdownMenu = inject(dropdownMenuInjectionKey);\n    const rawNodeRef = computed(() => props.tmNode.rawNode);\n    const hasSubmenuRef = computed(() => {\n      const {\n        value: childrenField\n      } = childrenFieldRef;\n      return isSubmenuNode(props.tmNode.rawNode, childrenField);\n    });\n    const mergedDisabledRef = computed(() => {\n      const {\n        disabled\n      } = props.tmNode;\n      return disabled;\n    });\n    const showSubmenuRef = computed(() => {\n      if (!hasSubmenuRef.value) return false;\n      const {\n        key,\n        disabled\n      } = props.tmNode;\n      if (disabled) return false;\n      const {\n        value: hoverKey\n      } = hoverKeyRef;\n      const {\n        value: keyboardKey\n      } = keyboardKeyRef;\n      const {\n        value: lastToggledSubmenuKey\n      } = lastToggledSubmenuKeyRef;\n      const {\n        value: pendingKeyPath\n      } = pendingKeyPathRef;\n      if (hoverKey !== null) return pendingKeyPath.includes(key);\n\n      if (keyboardKey !== null) {\n        return pendingKeyPath.includes(key) && pendingKeyPath[pendingKeyPath.length - 1] !== key;\n      }\n\n      if (lastToggledSubmenuKey !== null) return pendingKeyPath.includes(key);\n      return false;\n    });\n    const shouldDelayRef = computed(() => {\n      return keyboardKeyRef.value === null && !animatedRef.value;\n    });\n    const deferredShowSubmenuRef = useDeferredTrue(showSubmenuRef, 300, shouldDelayRef);\n    const parentEnteringSubmenuRef = computed(() => {\n      return !!(NDropdownOption === null || NDropdownOption === void 0 ? void 0 : NDropdownOption.enteringSubmenuRef.value);\n    });\n    const enteringSubmenuRef = ref(false);\n    provide(dropdownOptionInjectionKey, {\n      enteringSubmenuRef\n    }); // methods\n\n    function handleSubmenuBeforeEnter() {\n      enteringSubmenuRef.value = true;\n    }\n\n    function handleSubmenuAfterEnter() {\n      enteringSubmenuRef.value = false;\n    }\n\n    function handleMouseEnter() {\n      const {\n        parentKey,\n        tmNode\n      } = props;\n      if (!mergedShowRef.value) return;\n      lastToggledSubmenuKeyRef.value = parentKey;\n      keyboardKeyRef.value = null;\n      hoverKeyRef.value = tmNode.key;\n    }\n\n    function handleMouseMove() {\n      const {\n        tmNode\n      } = props;\n      if (!mergedShowRef.value) return;\n      if (hoverKeyRef.value === tmNode.key) return;\n      handleMouseEnter();\n    }\n\n    function handleMouseLeave(e) {\n      if (!mergedShowRef.value) return;\n      const {\n        relatedTarget\n      } = e;\n\n      if (relatedTarget && !happensIn({\n        target: relatedTarget\n      }, 'dropdownOption')) {\n        hoverKeyRef.value = null;\n      }\n    }\n\n    function handleClick() {\n      const {\n        value: hasSubmenu\n      } = hasSubmenuRef;\n      const {\n        tmNode\n      } = props;\n      if (!mergedShowRef.value) return;\n\n      if (!hasSubmenu && !tmNode.disabled) {\n        NDropdown.doSelect(tmNode.key, tmNode.rawNode);\n        NDropdown.doUpdateShow(false);\n      }\n    }\n\n    return {\n      labelField: labelFieldRef,\n      renderLabel: renderLabelRef,\n      renderIcon: renderIconRef,\n      siblingHasIcon: NDropdownMenu.showIconRef,\n      siblingHasSubmenu: NDropdownMenu.hasSubmenuRef,\n      animated: animatedRef,\n      mergedShowSubmenu: computed(() => {\n        return deferredShowSubmenuRef.value && !parentEnteringSubmenuRef.value;\n      }),\n      rawNode: rawNodeRef,\n      hasSubmenu: hasSubmenuRef,\n      pending: useMemo(() => {\n        const {\n          value: pendingKeyPath\n        } = pendingKeyPathRef;\n        const {\n          key\n        } = props.tmNode;\n        return pendingKeyPath.includes(key);\n      }),\n      childActive: useMemo(() => {\n        const {\n          value: activeKeyPath\n        } = activeKeyPathRef;\n        const {\n          key\n        } = props.tmNode;\n        const index = activeKeyPath.findIndex(k => key === k);\n        if (index === -1) return false;\n        return index < activeKeyPath.length - 1;\n      }),\n      active: useMemo(() => {\n        const {\n          value: activeKeyPath\n        } = activeKeyPathRef;\n        const {\n          key\n        } = props.tmNode;\n        const index = activeKeyPath.findIndex(k => key === k);\n        if (index === -1) return false;\n        return index === activeKeyPath.length - 1;\n      }),\n      mergedDisabled: mergedDisabledRef,\n      handleClick,\n      handleMouseMove,\n      handleMouseEnter,\n      handleMouseLeave,\n      handleSubmenuBeforeEnter,\n      handleSubmenuAfterEnter\n    };\n  },\n\n  render() {\n    var _a;\n\n    const {\n      animated,\n      rawNode,\n      mergedShowSubmenu,\n      clsPrefix,\n      siblingHasIcon,\n      siblingHasSubmenu,\n      renderLabel,\n      renderIcon,\n      props\n    } = this;\n    const submenuVNode = mergedShowSubmenu ? h(NDropdownMenu, {\n      clsPrefix: clsPrefix,\n      tmNodes: this.tmNode.children,\n      parentKey: this.tmNode.key\n    }) : null;\n    const builtinProps = {\n      class: [`${clsPrefix}-dropdown-option-body`, this.pending && `${clsPrefix}-dropdown-option-body--pending`, this.active && `${clsPrefix}-dropdown-option-body--active`, this.childActive && `${clsPrefix}-dropdown-option-body--child-active`, this.mergedDisabled && `${clsPrefix}-dropdown-option-body--disabled`],\n      onMousemove: this.handleMouseMove,\n      onMouseenter: this.handleMouseEnter,\n      onMouseleave: this.handleMouseLeave,\n      onClick: this.handleClick\n    };\n    return h(\"div\", {\n      class: `${clsPrefix}-dropdown-option`\n    }, h('div', mergeProps(builtinProps, props), [h(\"div\", {\n      \"data-dropdown-option\": true,\n      class: [`${clsPrefix}-dropdown-option-body__prefix`, siblingHasIcon && `${clsPrefix}-dropdown-option-body__prefix--show-icon`]\n    }, [renderIcon ? renderIcon(rawNode) : render(rawNode.icon)]), h(\"div\", {\n      \"data-dropdown-option\": true,\n      class: `${clsPrefix}-dropdown-option-body__label`\n    }, renderLabel ? renderLabel(rawNode) : render((_a = rawNode[this.labelField]) !== null && _a !== void 0 ? _a : rawNode.title)), h(\"div\", {\n      \"data-dropdown-option\": true,\n      class: [`${clsPrefix}-dropdown-option-body__suffix`, siblingHasSubmenu && `${clsPrefix}-dropdown-option-body__suffix--has-submenu`]\n    }, this.hasSubmenu ? h(NIcon, null, {\n      default: () => h(ChevronRightIcon, null)\n    }) : null)]), this.hasSubmenu ? h(VBinder, null, {\n      default: () => [h(VTarget, null, {\n        default: () => h(\"div\", {\n          class: `${clsPrefix}-dropdown-offset-container`\n        }, h(VFollower, {\n          show: this.mergedShowSubmenu,\n          placement: this.placement,\n          teleportDisabled: true\n        }, {\n          default: () => {\n            return h(\"div\", {\n              class: `${clsPrefix}-dropdown-menu-wrapper`\n            }, animated ? h(Transition, {\n              onBeforeEnter: this.handleSubmenuBeforeEnter,\n              onAfterEnter: this.handleSubmenuAfterEnter,\n              name: \"fade-in-scale-up-transition\",\n              appear: true\n            }, {\n              default: () => submenuVNode\n            }) : submenuVNode);\n          }\n        }))\n      })]\n    }) : null);\n  }\n\n});","map":{"version":3,"sources":["G:/VUE_FDS/fluent-vue/node_modules/naive-ui/es/dropdown/src/DropdownOption.js"],"names":["h","computed","inject","ref","Transition","defineComponent","provide","mergeProps","VBinder","VTarget","VFollower","useMemo","ChevronRightIcon","render","useDeferredTrue","NIcon","NDropdownMenu","dropdownMenuInjectionKey","dropdownInjectionKey","dropdownOptionInjectionKey","isSubmenuNode","happensIn","name","props","clsPrefix","type","String","required","tmNode","Object","parentKey","Number","default","placement","setup","NDropdown","hoverKeyRef","keyboardKeyRef","lastToggledSubmenuKeyRef","pendingKeyPathRef","activeKeyPathRef","animatedRef","mergedShowRef","renderLabelRef","renderIconRef","labelFieldRef","childrenFieldRef","NDropdownOption","rawNodeRef","rawNode","hasSubmenuRef","value","childrenField","mergedDisabledRef","disabled","showSubmenuRef","key","hoverKey","keyboardKey","lastToggledSubmenuKey","pendingKeyPath","includes","length","shouldDelayRef","deferredShowSubmenuRef","parentEnteringSubmenuRef","enteringSubmenuRef","handleSubmenuBeforeEnter","handleSubmenuAfterEnter","handleMouseEnter","handleMouseMove","handleMouseLeave","e","relatedTarget","target","handleClick","hasSubmenu","doSelect","doUpdateShow","labelField","renderLabel","renderIcon","siblingHasIcon","showIconRef","siblingHasSubmenu","animated","mergedShowSubmenu","pending","childActive","activeKeyPath","index","findIndex","k","active","mergedDisabled","_a","submenuVNode","tmNodes","children","builtinProps","class","onMousemove","onMouseenter","onMouseleave","onClick","icon","title","show","teleportDisabled","onBeforeEnter","onAfterEnter","appear"],"mappings":"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","sourcesContent":["import { h, computed, inject, ref, Transition, defineComponent, provide, mergeProps } from 'vue';\nimport { VBinder, VTarget, VFollower } from 'vueuc';\nimport { useMemo } from 'vooks';\nimport { ChevronRightIcon } from '../../_internal/icons';\nimport { render, useDeferredTrue } from '../../_utils';\nimport { NIcon } from '../../icon';\n// eslint-disable-next-line import/no-cycle\nimport NDropdownMenu from './DropdownMenu';\nimport { dropdownMenuInjectionKey, dropdownInjectionKey, dropdownOptionInjectionKey } from './context';\nimport { isSubmenuNode } from './utils';\nimport { happensIn } from 'seemly';\nexport default defineComponent({\n    name: 'DropdownOption',\n    props: {\n        clsPrefix: {\n            type: String,\n            required: true\n        },\n        tmNode: {\n            type: Object,\n            required: true\n        },\n        parentKey: {\n            type: [String, Number],\n            default: null\n        },\n        placement: {\n            type: String,\n            default: 'right-start'\n        },\n        props: Object\n    },\n    setup(props) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const NDropdown = inject(dropdownInjectionKey);\n        const { hoverKeyRef, keyboardKeyRef, lastToggledSubmenuKeyRef, pendingKeyPathRef, activeKeyPathRef, animatedRef, mergedShowRef, renderLabelRef, renderIconRef, labelFieldRef, childrenFieldRef } = NDropdown;\n        const NDropdownOption = inject(dropdownOptionInjectionKey, null);\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const NDropdownMenu = inject(dropdownMenuInjectionKey);\n        const rawNodeRef = computed(() => props.tmNode.rawNode);\n        const hasSubmenuRef = computed(() => {\n            const { value: childrenField } = childrenFieldRef;\n            return isSubmenuNode(props.tmNode.rawNode, childrenField);\n        });\n        const mergedDisabledRef = computed(() => {\n            const { disabled } = props.tmNode;\n            return disabled;\n        });\n        const showSubmenuRef = computed(() => {\n            if (!hasSubmenuRef.value)\n                return false;\n            const { key, disabled } = props.tmNode;\n            if (disabled)\n                return false;\n            const { value: hoverKey } = hoverKeyRef;\n            const { value: keyboardKey } = keyboardKeyRef;\n            const { value: lastToggledSubmenuKey } = lastToggledSubmenuKeyRef;\n            const { value: pendingKeyPath } = pendingKeyPathRef;\n            if (hoverKey !== null)\n                return pendingKeyPath.includes(key);\n            if (keyboardKey !== null) {\n                return (pendingKeyPath.includes(key) &&\n                    pendingKeyPath[pendingKeyPath.length - 1] !== key);\n            }\n            if (lastToggledSubmenuKey !== null)\n                return pendingKeyPath.includes(key);\n            return false;\n        });\n        const shouldDelayRef = computed(() => {\n            return keyboardKeyRef.value === null && !animatedRef.value;\n        });\n        const deferredShowSubmenuRef = useDeferredTrue(showSubmenuRef, 300, shouldDelayRef);\n        const parentEnteringSubmenuRef = computed(() => {\n            return !!(NDropdownOption === null || NDropdownOption === void 0 ? void 0 : NDropdownOption.enteringSubmenuRef.value);\n        });\n        const enteringSubmenuRef = ref(false);\n        provide(dropdownOptionInjectionKey, {\n            enteringSubmenuRef\n        });\n        // methods\n        function handleSubmenuBeforeEnter() {\n            enteringSubmenuRef.value = true;\n        }\n        function handleSubmenuAfterEnter() {\n            enteringSubmenuRef.value = false;\n        }\n        function handleMouseEnter() {\n            const { parentKey, tmNode } = props;\n            if (!mergedShowRef.value)\n                return;\n            lastToggledSubmenuKeyRef.value = parentKey;\n            keyboardKeyRef.value = null;\n            hoverKeyRef.value = tmNode.key;\n        }\n        function handleMouseMove() {\n            const { tmNode } = props;\n            if (!mergedShowRef.value)\n                return;\n            if (hoverKeyRef.value === tmNode.key)\n                return;\n            handleMouseEnter();\n        }\n        function handleMouseLeave(e) {\n            if (!mergedShowRef.value)\n                return;\n            const { relatedTarget } = e;\n            if (relatedTarget &&\n                !happensIn({ target: relatedTarget }, 'dropdownOption')) {\n                hoverKeyRef.value = null;\n            }\n        }\n        function handleClick() {\n            const { value: hasSubmenu } = hasSubmenuRef;\n            const { tmNode } = props;\n            if (!mergedShowRef.value)\n                return;\n            if (!hasSubmenu && !tmNode.disabled) {\n                NDropdown.doSelect(tmNode.key, tmNode.rawNode);\n                NDropdown.doUpdateShow(false);\n            }\n        }\n        return {\n            labelField: labelFieldRef,\n            renderLabel: renderLabelRef,\n            renderIcon: renderIconRef,\n            siblingHasIcon: NDropdownMenu.showIconRef,\n            siblingHasSubmenu: NDropdownMenu.hasSubmenuRef,\n            animated: animatedRef,\n            mergedShowSubmenu: computed(() => {\n                return deferredShowSubmenuRef.value && !parentEnteringSubmenuRef.value;\n            }),\n            rawNode: rawNodeRef,\n            hasSubmenu: hasSubmenuRef,\n            pending: useMemo(() => {\n                const { value: pendingKeyPath } = pendingKeyPathRef;\n                const { key } = props.tmNode;\n                return pendingKeyPath.includes(key);\n            }),\n            childActive: useMemo(() => {\n                const { value: activeKeyPath } = activeKeyPathRef;\n                const { key } = props.tmNode;\n                const index = activeKeyPath.findIndex((k) => key === k);\n                if (index === -1)\n                    return false;\n                return index < activeKeyPath.length - 1;\n            }),\n            active: useMemo(() => {\n                const { value: activeKeyPath } = activeKeyPathRef;\n                const { key } = props.tmNode;\n                const index = activeKeyPath.findIndex((k) => key === k);\n                if (index === -1)\n                    return false;\n                return index === activeKeyPath.length - 1;\n            }),\n            mergedDisabled: mergedDisabledRef,\n            handleClick,\n            handleMouseMove,\n            handleMouseEnter,\n            handleMouseLeave,\n            handleSubmenuBeforeEnter,\n            handleSubmenuAfterEnter\n        };\n    },\n    render() {\n        var _a;\n        const { animated, rawNode, mergedShowSubmenu, clsPrefix, siblingHasIcon, siblingHasSubmenu, renderLabel, renderIcon, props } = this;\n        const submenuVNode = mergedShowSubmenu ? (h(NDropdownMenu, { clsPrefix: clsPrefix, tmNodes: this.tmNode.children, parentKey: this.tmNode.key })) : null;\n        const builtinProps = {\n            class: [\n                `${clsPrefix}-dropdown-option-body`,\n                this.pending && `${clsPrefix}-dropdown-option-body--pending`,\n                this.active && `${clsPrefix}-dropdown-option-body--active`,\n                this.childActive && `${clsPrefix}-dropdown-option-body--child-active`,\n                this.mergedDisabled && `${clsPrefix}-dropdown-option-body--disabled`\n            ],\n            onMousemove: this.handleMouseMove,\n            onMouseenter: this.handleMouseEnter,\n            onMouseleave: this.handleMouseLeave,\n            onClick: this.handleClick\n        };\n        return (h(\"div\", { class: `${clsPrefix}-dropdown-option` },\n            h('div', mergeProps(builtinProps, props), [\n                h(\"div\", { \"data-dropdown-option\": true, class: [\n                        `${clsPrefix}-dropdown-option-body__prefix`,\n                        siblingHasIcon &&\n                            `${clsPrefix}-dropdown-option-body__prefix--show-icon`\n                    ] }, [renderIcon ? renderIcon(rawNode) : render(rawNode.icon)]),\n                h(\"div\", { \"data-dropdown-option\": true, class: `${clsPrefix}-dropdown-option-body__label` }, renderLabel\n                    ? renderLabel(rawNode)\n                    : render((_a = rawNode[this.labelField]) !== null && _a !== void 0 ? _a : rawNode.title)),\n                h(\"div\", { \"data-dropdown-option\": true, class: [\n                        `${clsPrefix}-dropdown-option-body__suffix`,\n                        siblingHasSubmenu &&\n                            `${clsPrefix}-dropdown-option-body__suffix--has-submenu`\n                    ] }, this.hasSubmenu ? (h(NIcon, null, {\n                    default: () => h(ChevronRightIcon, null)\n                })) : null)\n            ]),\n            this.hasSubmenu ? (h(VBinder, null, {\n                default: () => [\n                    h(VTarget, null, {\n                        default: () => (h(\"div\", { class: `${clsPrefix}-dropdown-offset-container` },\n                            h(VFollower, { show: this.mergedShowSubmenu, placement: this.placement, teleportDisabled: true }, {\n                                default: () => {\n                                    return (h(\"div\", { class: `${clsPrefix}-dropdown-menu-wrapper` }, animated ? (h(Transition, { onBeforeEnter: this.handleSubmenuBeforeEnter, onAfterEnter: this.handleSubmenuAfterEnter, name: \"fade-in-scale-up-transition\", appear: true }, {\n                                        default: () => submenuVNode\n                                    })) : (submenuVNode)));\n                                }\n                            })))\n                    })\n                ]\n            })) : null));\n    }\n});\n"]},"metadata":{},"sourceType":"module"}