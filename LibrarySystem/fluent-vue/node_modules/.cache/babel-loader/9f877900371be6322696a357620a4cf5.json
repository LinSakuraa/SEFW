{"ast":null,"code":"import { h, ref, onMounted, computed, defineComponent, toRef, provide, nextTick, watch } from 'vue';\nimport { createIndexGetter } from 'treemate';\nimport { VirtualList } from 'vueuc';\nimport { depx, getPadding, happensIn } from 'seemly';\nimport { NEmpty } from '../../../empty';\nimport { NScrollbar } from '../../scrollbar';\nimport { formatLength, resolveSlot, resolveWrappedSlot } from '../../../_utils';\nimport { createKey } from '../../../_utils/cssr';\nimport { useThemeClass, useTheme } from '../../../_mixins';\nimport NInternalLoading from '../../loading';\nimport NFocusDetector from '../../focus-detector';\nimport { internalSelectMenuLight } from '../styles';\nimport NSelectOption from './SelectOption';\nimport NSelectGroupHeader from './SelectGroupHeader';\nimport { internalSelectionMenuInjectionKey, internalSelectionMenuBodyInjectionKey } from './interface';\nimport style from './styles/index.cssr';\nexport default defineComponent({\n  name: 'InternalSelectMenu',\n  props: Object.assign(Object.assign({}, useTheme.props), {\n    clsPrefix: {\n      type: String,\n      required: true\n    },\n    scrollable: {\n      type: Boolean,\n      default: true\n    },\n    treeMate: {\n      type: Object,\n      required: true\n    },\n    multiple: Boolean,\n    size: {\n      type: String,\n      default: 'medium'\n    },\n    value: {\n      type: [String, Number, Array],\n      default: null\n    },\n    width: [Number, String],\n    autoPending: Boolean,\n    virtualScroll: {\n      type: Boolean,\n      default: true\n    },\n    // show is used to toggle pending state initialization\n    show: {\n      type: Boolean,\n      default: true\n    },\n    loading: Boolean,\n    focusable: Boolean,\n    renderLabel: Function,\n    renderOption: Function,\n    onMousedown: Function,\n    onScroll: Function,\n    onFocus: Function,\n    onBlur: Function,\n    onKeyup: Function,\n    onKeydown: Function,\n    onTabOut: Function,\n    onMouseenter: Function,\n    onMouseleave: Function,\n    resetMenuOnOptionsChange: {\n      type: Boolean,\n      default: true\n    },\n    inlineThemeDisabled: Boolean,\n    // deprecated\n    onToggle: Function\n  }),\n\n  setup(props) {\n    const themeRef = useTheme('InternalSelectMenu', '-internal-select-menu', style, internalSelectMenuLight, props, toRef(props, 'clsPrefix'));\n    const selfRef = ref(null);\n    const virtualListRef = ref(null);\n    const scrollbarRef = ref(null);\n    const flattenedNodesRef = computed(() => props.treeMate.getFlattenedNodes());\n    const fIndexGetterRef = computed(() => createIndexGetter(flattenedNodesRef.value));\n    const pendingNodeRef = ref(null);\n\n    function initPendingNode() {\n      const {\n        treeMate\n      } = props;\n      let defaultPendingNode = null;\n\n      if (props.autoPending) {\n        const {\n          value\n        } = props;\n\n        if (value === null) {\n          defaultPendingNode = treeMate.getFirstAvailableNode();\n        } else {\n          if (props.multiple) {\n            defaultPendingNode = treeMate.getNode((value || [])[(value || []).length - 1]);\n          } else {\n            defaultPendingNode = treeMate.getNode(value);\n          }\n\n          if (!defaultPendingNode || defaultPendingNode.disabled) {\n            defaultPendingNode = treeMate.getFirstAvailableNode();\n          }\n        }\n\n        if (defaultPendingNode) {\n          setPendingTmNode(defaultPendingNode);\n        }\n      }\n    }\n\n    let initPendingNodeWatchStopHandle;\n    watch(toRef(props, 'show'), value => {\n      if (value) {\n        initPendingNodeWatchStopHandle = watch(props.resetMenuOnOptionsChange ? [toRef(props, 'treeMate'), toRef(props, 'multiple')] : [toRef(props, 'multiple')], () => {\n          initPendingNode();\n          void nextTick(scrollToPendingNode);\n        }, {\n          immediate: true\n        });\n      } else {\n        initPendingNodeWatchStopHandle === null || initPendingNodeWatchStopHandle === void 0 ? void 0 : initPendingNodeWatchStopHandle();\n      }\n    }, {\n      immediate: true\n    });\n    const itemSizeRef = computed(() => {\n      return depx(themeRef.value.self[createKey('optionHeight', props.size)]);\n    });\n    const paddingRef = computed(() => {\n      return getPadding(themeRef.value.self[createKey('padding', props.size)]);\n    });\n    const valueSetRef = computed(() => {\n      if (props.multiple && Array.isArray(props.value)) {\n        return new Set(props.value);\n      }\n\n      return new Set();\n    });\n    const emptyRef = computed(() => {\n      const tmNodes = flattenedNodesRef.value;\n      return tmNodes && tmNodes.length === 0;\n    });\n\n    function doToggle(tmNode) {\n      const {\n        onToggle\n      } = props;\n      if (onToggle) onToggle(tmNode);\n    }\n\n    function doScroll(e) {\n      const {\n        onScroll\n      } = props;\n      if (onScroll) onScroll(e);\n    } // required, scroller sync need to be triggered manually\n\n\n    function handleVirtualListScroll(e) {\n      var _a;\n\n      (_a = scrollbarRef.value) === null || _a === void 0 ? void 0 : _a.sync();\n      doScroll(e);\n    }\n\n    function handleVirtualListResize() {\n      var _a;\n\n      (_a = scrollbarRef.value) === null || _a === void 0 ? void 0 : _a.sync();\n    }\n\n    function getPendingTmNode() {\n      const {\n        value: pendingTmNode\n      } = pendingNodeRef;\n      if (pendingTmNode) return pendingTmNode;\n      return null;\n    }\n\n    function handleOptionMouseEnter(e, tmNode) {\n      if (tmNode.disabled) return;\n      setPendingTmNode(tmNode, false);\n    }\n\n    function handleOptionClick(e, tmNode) {\n      if (tmNode.disabled) return;\n      doToggle(tmNode);\n    } // keyboard related methods\n\n\n    function handleKeyUp(e) {\n      var _a;\n\n      if (happensIn(e, 'action')) return;\n      (_a = props.onKeyup) === null || _a === void 0 ? void 0 : _a.call(props, e);\n    }\n\n    function handleKeyDown(e) {\n      var _a;\n\n      if (happensIn(e, 'action')) return;\n      (_a = props.onKeydown) === null || _a === void 0 ? void 0 : _a.call(props, e);\n    }\n\n    function handleMouseDown(e) {\n      var _a;\n\n      (_a = props.onMousedown) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      if (props.focusable) return;\n      e.preventDefault();\n    }\n\n    function next() {\n      const {\n        value: pendingTmNode\n      } = pendingNodeRef;\n\n      if (pendingTmNode) {\n        setPendingTmNode(pendingTmNode.getNext({\n          loop: true\n        }), true);\n      }\n    }\n\n    function prev() {\n      const {\n        value: pendingTmNode\n      } = pendingNodeRef;\n\n      if (pendingTmNode) {\n        setPendingTmNode(pendingTmNode.getPrev({\n          loop: true\n        }), true);\n      }\n    }\n\n    function setPendingTmNode(tmNode, doScroll = false) {\n      pendingNodeRef.value = tmNode;\n      if (doScroll) scrollToPendingNode();\n    }\n\n    function scrollToPendingNode() {\n      var _a, _b;\n\n      const tmNode = pendingNodeRef.value;\n      if (!tmNode) return;\n      const fIndex = fIndexGetterRef.value(tmNode.key);\n      if (fIndex === null) return;\n\n      if (props.virtualScroll) {\n        (_a = virtualListRef.value) === null || _a === void 0 ? void 0 : _a.scrollTo({\n          index: fIndex\n        });\n      } else {\n        (_b = scrollbarRef.value) === null || _b === void 0 ? void 0 : _b.scrollTo({\n          index: fIndex,\n          elSize: itemSizeRef.value\n        });\n      }\n    }\n\n    function handleFocusin(e) {\n      var _a, _b;\n\n      if ((_a = selfRef.value) === null || _a === void 0 ? void 0 : _a.contains(e.target)) {\n        (_b = props.onFocus) === null || _b === void 0 ? void 0 : _b.call(props, e);\n      }\n    }\n\n    function handleFocusout(e) {\n      var _a, _b;\n\n      if (!((_a = selfRef.value) === null || _a === void 0 ? void 0 : _a.contains(e.relatedTarget))) {\n        (_b = props.onBlur) === null || _b === void 0 ? void 0 : _b.call(props, e);\n      }\n    }\n\n    provide(internalSelectionMenuInjectionKey, {\n      handleOptionMouseEnter,\n      handleOptionClick,\n      valueSetRef,\n      multipleRef: toRef(props, 'multiple'),\n      valueRef: toRef(props, 'value'),\n      renderLabelRef: toRef(props, 'renderLabel'),\n      renderOptionRef: toRef(props, 'renderOption'),\n      pendingTmNodeRef: pendingNodeRef\n    });\n    provide(internalSelectionMenuBodyInjectionKey, selfRef);\n    onMounted(() => {\n      const {\n        value\n      } = scrollbarRef;\n      if (value) value.sync();\n    });\n    const cssVarsRef = computed(() => {\n      const {\n        size\n      } = props;\n      const {\n        common: {\n          cubicBezierEaseInOut\n        },\n        self: {\n          height,\n          borderRadius,\n          color,\n          groupHeaderTextColor,\n          actionDividerColor,\n          optionTextColorPressed,\n          optionTextColor,\n          optionTextColorDisabled,\n          optionTextColorActive,\n          optionOpacityDisabled,\n          optionCheckColor,\n          actionTextColor,\n          optionColorPending,\n          optionColorActive,\n          loadingColor,\n          loadingSize,\n          [createKey('optionFontSize', size)]: fontSize,\n          [createKey('optionHeight', size)]: optionHeight,\n          [createKey('optionPadding', size)]: optionPadding\n        }\n      } = themeRef.value;\n      return {\n        '--n-height': height,\n        '--n-action-divider-color': actionDividerColor,\n        '--n-action-text-color': actionTextColor,\n        '--n-bezier': cubicBezierEaseInOut,\n        '--n-border-radius': borderRadius,\n        '--n-color': color,\n        '--n-option-font-size': fontSize,\n        '--n-group-header-text-color': groupHeaderTextColor,\n        '--n-option-check-color': optionCheckColor,\n        '--n-option-color-pending': optionColorPending,\n        '--n-option-color-active': optionColorActive,\n        '--n-option-height': optionHeight,\n        '--n-option-opacity-disabled': optionOpacityDisabled,\n        '--n-option-text-color': optionTextColor,\n        '--n-option-text-color-active': optionTextColorActive,\n        '--n-option-text-color-disabled': optionTextColorDisabled,\n        '--n-option-text-color-pressed': optionTextColorPressed,\n        '--n-option-padding': optionPadding,\n        '--n-option-padding-left': getPadding(optionPadding, 'left'),\n        '--n-loading-color': loadingColor,\n        '--n-loading-size': loadingSize\n      };\n    });\n    const {\n      inlineThemeDisabled\n    } = props;\n    const themeClassHandle = inlineThemeDisabled ? useThemeClass('internal-select-menu', computed(() => props.size[0]), cssVarsRef, props) : undefined;\n    const exposedProps = {\n      selfRef,\n      next,\n      prev,\n      getPendingTmNode\n    };\n    return Object.assign({\n      mergedTheme: themeRef,\n      virtualListRef,\n      scrollbarRef,\n      itemSize: itemSizeRef,\n      padding: paddingRef,\n      flattenedNodes: flattenedNodesRef,\n      empty: emptyRef,\n\n      virtualListContainer() {\n        const {\n          value\n        } = virtualListRef;\n        return value === null || value === void 0 ? void 0 : value.listElRef;\n      },\n\n      virtualListContent() {\n        const {\n          value\n        } = virtualListRef;\n        return value === null || value === void 0 ? void 0 : value.itemsElRef;\n      },\n\n      doScroll,\n      handleFocusin,\n      handleFocusout,\n      handleKeyUp,\n      handleKeyDown,\n      handleMouseDown,\n      handleVirtualListResize,\n      handleVirtualListScroll,\n      cssVars: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender\n    }, exposedProps);\n  },\n\n  render() {\n    const {\n      $slots,\n      virtualScroll,\n      clsPrefix,\n      mergedTheme,\n      themeClass,\n      onRender\n    } = this;\n    onRender === null || onRender === void 0 ? void 0 : onRender();\n    return h(\"div\", {\n      ref: \"selfRef\",\n      tabindex: this.focusable ? 0 : -1,\n      class: [`${clsPrefix}-base-select-menu`, themeClass, this.multiple && `${clsPrefix}-base-select-menu--multiple`],\n      style: [{\n        width: formatLength(this.width)\n      }, this.cssVars],\n      onFocusin: this.handleFocusin,\n      onFocusout: this.handleFocusout,\n      onKeyup: this.handleKeyUp,\n      onKeydown: this.handleKeyDown,\n      onMousedown: this.handleMouseDown,\n      onMouseenter: this.onMouseenter,\n      onMouseleave: this.onMouseleave\n    }, this.loading ? h(\"div\", {\n      class: `${clsPrefix}-base-select-menu__loading`\n    }, h(NInternalLoading, {\n      clsPrefix: clsPrefix,\n      strokeWidth: 20\n    })) : !this.empty ? h(NScrollbar, {\n      ref: \"scrollbarRef\",\n      theme: mergedTheme.peers.Scrollbar,\n      themeOverrides: mergedTheme.peerOverrides.Scrollbar,\n      scrollable: this.scrollable,\n      container: virtualScroll ? this.virtualListContainer : undefined,\n      content: virtualScroll ? this.virtualListContent : undefined,\n      onScroll: virtualScroll ? undefined : this.doScroll\n    }, {\n      default: () => {\n        return virtualScroll ? h(VirtualList, {\n          ref: \"virtualListRef\",\n          class: `${clsPrefix}-virtual-list`,\n          items: this.flattenedNodes,\n          itemSize: this.itemSize,\n          showScrollbar: false,\n          paddingTop: this.padding.top,\n          paddingBottom: this.padding.bottom,\n          onResize: this.handleVirtualListResize,\n          onScroll: this.handleVirtualListScroll,\n          itemResizable: true\n        }, {\n          default: ({\n            item: tmNode\n          }) => {\n            return tmNode.isGroup ? h(NSelectGroupHeader, {\n              key: tmNode.key,\n              clsPrefix: clsPrefix,\n              tmNode: tmNode\n            }) : tmNode.ignored ? null : h(NSelectOption, {\n              clsPrefix: clsPrefix,\n              key: tmNode.key,\n              tmNode: tmNode\n            });\n          }\n        }) : h(\"div\", {\n          class: `${clsPrefix}-base-select-menu-option-wrapper`,\n          style: {\n            paddingTop: this.padding.top,\n            paddingBottom: this.padding.bottom\n          }\n        }, this.flattenedNodes.map(tmNode => tmNode.isGroup ? h(NSelectGroupHeader, {\n          key: tmNode.key,\n          clsPrefix: clsPrefix,\n          tmNode: tmNode\n        }) : h(NSelectOption, {\n          clsPrefix: clsPrefix,\n          key: tmNode.key,\n          tmNode: tmNode\n        })));\n      }\n    }) : h(\"div\", {\n      class: `${clsPrefix}-base-select-menu__empty`\n    }, resolveSlot($slots.empty, () => [h(NEmpty, {\n      theme: mergedTheme.peers.Empty,\n      themeOverrides: mergedTheme.peerOverrides.Empty\n    })])), resolveWrappedSlot($slots.action, children => children && [h(\"div\", {\n      class: `${clsPrefix}-base-select-menu__action`,\n      \"data-action\": true,\n      key: \"action\"\n    }, children), h(NFocusDetector, {\n      onFocus: this.onTabOut,\n      key: \"focus-detector\"\n    })]));\n  }\n\n});","map":{"version":3,"sources":["G:/VUE_FDS/fluent-vue/node_modules/naive-ui/es/_internal/select-menu/src/SelectMenu.js"],"names":["h","ref","onMounted","computed","defineComponent","toRef","provide","nextTick","watch","createIndexGetter","VirtualList","depx","getPadding","happensIn","NEmpty","NScrollbar","formatLength","resolveSlot","resolveWrappedSlot","createKey","useThemeClass","useTheme","NInternalLoading","NFocusDetector","internalSelectMenuLight","NSelectOption","NSelectGroupHeader","internalSelectionMenuInjectionKey","internalSelectionMenuBodyInjectionKey","style","name","props","Object","assign","clsPrefix","type","String","required","scrollable","Boolean","default","treeMate","multiple","size","value","Number","Array","width","autoPending","virtualScroll","show","loading","focusable","renderLabel","Function","renderOption","onMousedown","onScroll","onFocus","onBlur","onKeyup","onKeydown","onTabOut","onMouseenter","onMouseleave","resetMenuOnOptionsChange","inlineThemeDisabled","onToggle","setup","themeRef","selfRef","virtualListRef","scrollbarRef","flattenedNodesRef","getFlattenedNodes","fIndexGetterRef","pendingNodeRef","initPendingNode","defaultPendingNode","getFirstAvailableNode","getNode","length","disabled","setPendingTmNode","initPendingNodeWatchStopHandle","scrollToPendingNode","immediate","itemSizeRef","self","paddingRef","valueSetRef","isArray","Set","emptyRef","tmNodes","doToggle","tmNode","doScroll","e","handleVirtualListScroll","_a","sync","handleVirtualListResize","getPendingTmNode","pendingTmNode","handleOptionMouseEnter","handleOptionClick","handleKeyUp","call","handleKeyDown","handleMouseDown","preventDefault","next","getNext","loop","prev","getPrev","_b","fIndex","key","scrollTo","index","elSize","handleFocusin","contains","target","handleFocusout","relatedTarget","multipleRef","valueRef","renderLabelRef","renderOptionRef","pendingTmNodeRef","cssVarsRef","common","cubicBezierEaseInOut","height","borderRadius","color","groupHeaderTextColor","actionDividerColor","optionTextColorPressed","optionTextColor","optionTextColorDisabled","optionTextColorActive","optionOpacityDisabled","optionCheckColor","actionTextColor","optionColorPending","optionColorActive","loadingColor","loadingSize","fontSize","optionHeight","optionPadding","themeClassHandle","undefined","exposedProps","mergedTheme","itemSize","padding","flattenedNodes","empty","virtualListContainer","listElRef","virtualListContent","itemsElRef","cssVars","themeClass","onRender","render","$slots","tabindex","class","onFocusin","onFocusout","strokeWidth","theme","peers","Scrollbar","themeOverrides","peerOverrides","container","content","items","showScrollbar","paddingTop","top","paddingBottom","bottom","onResize","itemResizable","item","isGroup","ignored","map","Empty","action","children"],"mappings":"AAAA,SAASA,CAAT,EAAYC,GAAZ,EAAiBC,SAAjB,EAA4BC,QAA5B,EAAsCC,eAAtC,EAAuDC,KAAvD,EAA8DC,OAA9D,EAAuEC,QAAvE,EAAiFC,KAAjF,QAA8F,KAA9F;AACA,SAASC,iBAAT,QAAkC,UAAlC;AACA,SAASC,WAAT,QAA4B,OAA5B;AACA,SAASC,IAAT,EAAeC,UAAf,EAA2BC,SAA3B,QAA4C,QAA5C;AACA,SAASC,MAAT,QAAuB,gBAAvB;AACA,SAASC,UAAT,QAA2B,iBAA3B;AACA,SAASC,YAAT,EAAuBC,WAAvB,EAAoCC,kBAApC,QAA8D,iBAA9D;AACA,SAASC,SAAT,QAA0B,sBAA1B;AACA,SAASC,aAAT,EAAwBC,QAAxB,QAAwC,kBAAxC;AACA,OAAOC,gBAAP,MAA6B,eAA7B;AACA,OAAOC,cAAP,MAA2B,sBAA3B;AACA,SAASC,uBAAT,QAAwC,WAAxC;AACA,OAAOC,aAAP,MAA0B,gBAA1B;AACA,OAAOC,kBAAP,MAA+B,qBAA/B;AACA,SAASC,iCAAT,EAA4CC,qCAA5C,QAAyF,aAAzF;AACA,OAAOC,KAAP,MAAkB,qBAAlB;AACA,eAAezB,eAAe,CAAC;AAC3B0B,EAAAA,IAAI,EAAE,oBADqB;AAE3BC,EAAAA,KAAK,EAAEC,MAAM,CAACC,MAAP,CAAcD,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBZ,QAAQ,CAACU,KAA3B,CAAd,EAAiD;AAAEG,IAAAA,SAAS,EAAE;AAC7DC,MAAAA,IAAI,EAAEC,MADuD;AAE7DC,MAAAA,QAAQ,EAAE;AAFmD,KAAb;AAGjDC,IAAAA,UAAU,EAAE;AACXH,MAAAA,IAAI,EAAEI,OADK;AAEXC,MAAAA,OAAO,EAAE;AAFE,KAHqC;AAMjDC,IAAAA,QAAQ,EAAE;AACTN,MAAAA,IAAI,EAAEH,MADG;AAETK,MAAAA,QAAQ,EAAE;AAFD,KANuC;AASjDK,IAAAA,QAAQ,EAAEH,OATuC;AAS9BI,IAAAA,IAAI,EAAE;AACxBR,MAAAA,IAAI,EAAEC,MADkB;AAExBI,MAAAA,OAAO,EAAE;AAFe,KATwB;AAYjDI,IAAAA,KAAK,EAAE;AACNT,MAAAA,IAAI,EAAE,CAACC,MAAD,EAASS,MAAT,EAAiBC,KAAjB,CADA;AAENN,MAAAA,OAAO,EAAE;AAFH,KAZ0C;AAejDO,IAAAA,KAAK,EAAE,CAACF,MAAD,EAAST,MAAT,CAf0C;AAexBY,IAAAA,WAAW,EAAET,OAfW;AAeFU,IAAAA,aAAa,EAAE;AAC7Dd,MAAAA,IAAI,EAAEI,OADuD;AAE7DC,MAAAA,OAAO,EAAE;AAFoD,KAfb;AAmBpD;AACAU,IAAAA,IAAI,EAAE;AACFf,MAAAA,IAAI,EAAEI,OADJ;AAEFC,MAAAA,OAAO,EAAE;AAFP,KApB8C;AAuBjDW,IAAAA,OAAO,EAAEZ,OAvBwC;AAuB/Ba,IAAAA,SAAS,EAAEb,OAvBoB;AAuBXc,IAAAA,WAAW,EAAEC,QAvBF;AAuBYC,IAAAA,YAAY,EAAED,QAvB1B;AAuBoCE,IAAAA,WAAW,EAAEF,QAvBjD;AAuB2DG,IAAAA,QAAQ,EAAEH,QAvBrE;AAuB+EI,IAAAA,OAAO,EAAEJ,QAvBxF;AAuBkGK,IAAAA,MAAM,EAAEL,QAvB1G;AAuBoHM,IAAAA,OAAO,EAAEN,QAvB7H;AAuBuIO,IAAAA,SAAS,EAAEP,QAvBlJ;AAuB4JQ,IAAAA,QAAQ,EAAER,QAvBtK;AAuBgLS,IAAAA,YAAY,EAAET,QAvB9L;AAuBwMU,IAAAA,YAAY,EAAEV,QAvBtN;AAuBgOW,IAAAA,wBAAwB,EAAE;AAC1S9B,MAAAA,IAAI,EAAEI,OADoS;AAE1SC,MAAAA,OAAO,EAAE;AAFiS,KAvB1P;AA0BjD0B,IAAAA,mBAAmB,EAAE3B,OA1B4B;AA2BpD;AACA4B,IAAAA,QAAQ,EAAEb;AA5B0C,GAAjD,CAFoB;;AA+B3Bc,EAAAA,KAAK,CAACrC,KAAD,EAAQ;AACT,UAAMsC,QAAQ,GAAGhD,QAAQ,CAAC,oBAAD,EAAuB,uBAAvB,EAAgDQ,KAAhD,EAAuDL,uBAAvD,EAAgFO,KAAhF,EAAuF1B,KAAK,CAAC0B,KAAD,EAAQ,WAAR,CAA5F,CAAzB;AACA,UAAMuC,OAAO,GAAGrE,GAAG,CAAC,IAAD,CAAnB;AACA,UAAMsE,cAAc,GAAGtE,GAAG,CAAC,IAAD,CAA1B;AACA,UAAMuE,YAAY,GAAGvE,GAAG,CAAC,IAAD,CAAxB;AACA,UAAMwE,iBAAiB,GAAGtE,QAAQ,CAAC,MAAM4B,KAAK,CAACU,QAAN,CAAeiC,iBAAf,EAAP,CAAlC;AACA,UAAMC,eAAe,GAAGxE,QAAQ,CAAC,MAAMM,iBAAiB,CAACgE,iBAAiB,CAAC7B,KAAnB,CAAxB,CAAhC;AACA,UAAMgC,cAAc,GAAG3E,GAAG,CAAC,IAAD,CAA1B;;AACA,aAAS4E,eAAT,GAA2B;AACvB,YAAM;AAAEpC,QAAAA;AAAF,UAAeV,KAArB;AACA,UAAI+C,kBAAkB,GAAG,IAAzB;;AACA,UAAI/C,KAAK,CAACiB,WAAV,EAAuB;AACnB,cAAM;AAAEJ,UAAAA;AAAF,YAAYb,KAAlB;;AACA,YAAIa,KAAK,KAAK,IAAd,EAAoB;AAChBkC,UAAAA,kBAAkB,GAAGrC,QAAQ,CAACsC,qBAAT,EAArB;AACH,SAFD,MAGK;AACD,cAAIhD,KAAK,CAACW,QAAV,EAAoB;AAChBoC,YAAAA,kBAAkB,GAAGrC,QAAQ,CAACuC,OAAT,CAAiB,CAACpC,KAAK,IAAI,EAAV,EAAc,CAACA,KAAK,IAAI,EAAV,EAAcqC,MAAd,GAAuB,CAArC,CAAjB,CAArB;AACH,WAFD,MAGK;AACDH,YAAAA,kBAAkB,GAAGrC,QAAQ,CAACuC,OAAT,CAAiBpC,KAAjB,CAArB;AACH;;AACD,cAAI,CAACkC,kBAAD,IAAuBA,kBAAkB,CAACI,QAA9C,EAAwD;AACpDJ,YAAAA,kBAAkB,GAAGrC,QAAQ,CAACsC,qBAAT,EAArB;AACH;AACJ;;AACD,YAAID,kBAAJ,EAAwB;AACpBK,UAAAA,gBAAgB,CAACL,kBAAD,CAAhB;AACH;AACJ;AACJ;;AACD,QAAIM,8BAAJ;AACA5E,IAAAA,KAAK,CAACH,KAAK,CAAC0B,KAAD,EAAQ,MAAR,CAAN,EAAwBa,KAAD,IAAW;AACnC,UAAIA,KAAJ,EAAW;AACPwC,QAAAA,8BAA8B,GAAG5E,KAAK,CAACuB,KAAK,CAACkC,wBAAN,GACjC,CAAC5D,KAAK,CAAC0B,KAAD,EAAQ,UAAR,CAAN,EAA2B1B,KAAK,CAAC0B,KAAD,EAAQ,UAAR,CAAhC,CADiC,GAEjC,CAAC1B,KAAK,CAAC0B,KAAD,EAAQ,UAAR,CAAN,CAFgC,EAEJ,MAAM;AACpC8C,UAAAA,eAAe;AACf,eAAKtE,QAAQ,CAAC8E,mBAAD,CAAb;AACH,SALqC,EAKnC;AACCC,UAAAA,SAAS,EAAE;AADZ,SALmC,CAAtC;AAQH,OATD,MAUK;AACDF,QAAAA,8BAA8B,KAAK,IAAnC,IAA2CA,8BAA8B,KAAK,KAAK,CAAnF,GAAuF,KAAK,CAA5F,GAAgGA,8BAA8B,EAA9H;AACH;AACJ,KAdI,EAcF;AACCE,MAAAA,SAAS,EAAE;AADZ,KAdE,CAAL;AAiBA,UAAMC,WAAW,GAAGpF,QAAQ,CAAC,MAAM;AAC/B,aAAOQ,IAAI,CAAC0D,QAAQ,CAACzB,KAAT,CAAe4C,IAAf,CAAoBrE,SAAS,CAAC,cAAD,EAAiBY,KAAK,CAACY,IAAvB,CAA7B,CAAD,CAAX;AACH,KAF2B,CAA5B;AAGA,UAAM8C,UAAU,GAAGtF,QAAQ,CAAC,MAAM;AAC9B,aAAOS,UAAU,CAACyD,QAAQ,CAACzB,KAAT,CAAe4C,IAAf,CAAoBrE,SAAS,CAAC,SAAD,EAAYY,KAAK,CAACY,IAAlB,CAA7B,CAAD,CAAjB;AACH,KAF0B,CAA3B;AAGA,UAAM+C,WAAW,GAAGvF,QAAQ,CAAC,MAAM;AAC/B,UAAI4B,KAAK,CAACW,QAAN,IAAkBI,KAAK,CAAC6C,OAAN,CAAc5D,KAAK,CAACa,KAApB,CAAtB,EAAkD;AAC9C,eAAO,IAAIgD,GAAJ,CAAQ7D,KAAK,CAACa,KAAd,CAAP;AACH;;AACD,aAAO,IAAIgD,GAAJ,EAAP;AACH,KAL2B,CAA5B;AAMA,UAAMC,QAAQ,GAAG1F,QAAQ,CAAC,MAAM;AAC5B,YAAM2F,OAAO,GAAGrB,iBAAiB,CAAC7B,KAAlC;AACA,aAAOkD,OAAO,IAAIA,OAAO,CAACb,MAAR,KAAmB,CAArC;AACH,KAHwB,CAAzB;;AAIA,aAASc,QAAT,CAAkBC,MAAlB,EAA0B;AACtB,YAAM;AAAE7B,QAAAA;AAAF,UAAepC,KAArB;AACA,UAAIoC,QAAJ,EACIA,QAAQ,CAAC6B,MAAD,CAAR;AACP;;AACD,aAASC,QAAT,CAAkBC,CAAlB,EAAqB;AACjB,YAAM;AAAEzC,QAAAA;AAAF,UAAe1B,KAArB;AACA,UAAI0B,QAAJ,EACIA,QAAQ,CAACyC,CAAD,CAAR;AACP,KA3EQ,CA4ET;;;AACA,aAASC,uBAAT,CAAiCD,CAAjC,EAAoC;AAChC,UAAIE,EAAJ;;AACA,OAACA,EAAE,GAAG5B,YAAY,CAAC5B,KAAnB,MAA8B,IAA9B,IAAsCwD,EAAE,KAAK,KAAK,CAAlD,GAAsD,KAAK,CAA3D,GAA+DA,EAAE,CAACC,IAAH,EAA/D;AACAJ,MAAAA,QAAQ,CAACC,CAAD,CAAR;AACH;;AACD,aAASI,uBAAT,GAAmC;AAC/B,UAAIF,EAAJ;;AACA,OAACA,EAAE,GAAG5B,YAAY,CAAC5B,KAAnB,MAA8B,IAA9B,IAAsCwD,EAAE,KAAK,KAAK,CAAlD,GAAsD,KAAK,CAA3D,GAA+DA,EAAE,CAACC,IAAH,EAA/D;AACH;;AACD,aAASE,gBAAT,GAA4B;AACxB,YAAM;AAAE3D,QAAAA,KAAK,EAAE4D;AAAT,UAA2B5B,cAAjC;AACA,UAAI4B,aAAJ,EACI,OAAOA,aAAP;AACJ,aAAO,IAAP;AACH;;AACD,aAASC,sBAAT,CAAgCP,CAAhC,EAAmCF,MAAnC,EAA2C;AACvC,UAAIA,MAAM,CAACd,QAAX,EACI;AACJC,MAAAA,gBAAgB,CAACa,MAAD,EAAS,KAAT,CAAhB;AACH;;AACD,aAASU,iBAAT,CAA2BR,CAA3B,EAA8BF,MAA9B,EAAsC;AAClC,UAAIA,MAAM,CAACd,QAAX,EACI;AACJa,MAAAA,QAAQ,CAACC,MAAD,CAAR;AACH,KArGQ,CAsGT;;;AACA,aAASW,WAAT,CAAqBT,CAArB,EAAwB;AACpB,UAAIE,EAAJ;;AACA,UAAIvF,SAAS,CAACqF,CAAD,EAAI,QAAJ,CAAb,EACI;AACJ,OAACE,EAAE,GAAGrE,KAAK,CAAC6B,OAAZ,MAAyB,IAAzB,IAAiCwC,EAAE,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,EAAE,CAACQ,IAAH,CAAQ7E,KAAR,EAAemE,CAAf,CAA1D;AACH;;AACD,aAASW,aAAT,CAAuBX,CAAvB,EAA0B;AACtB,UAAIE,EAAJ;;AACA,UAAIvF,SAAS,CAACqF,CAAD,EAAI,QAAJ,CAAb,EACI;AACJ,OAACE,EAAE,GAAGrE,KAAK,CAAC8B,SAAZ,MAA2B,IAA3B,IAAmCuC,EAAE,KAAK,KAAK,CAA/C,GAAmD,KAAK,CAAxD,GAA4DA,EAAE,CAACQ,IAAH,CAAQ7E,KAAR,EAAemE,CAAf,CAA5D;AACH;;AACD,aAASY,eAAT,CAAyBZ,CAAzB,EAA4B;AACxB,UAAIE,EAAJ;;AACA,OAACA,EAAE,GAAGrE,KAAK,CAACyB,WAAZ,MAA6B,IAA7B,IAAqC4C,EAAE,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,EAAE,CAACQ,IAAH,CAAQ7E,KAAR,EAAemE,CAAf,CAA9D;AACA,UAAInE,KAAK,CAACqB,SAAV,EACI;AACJ8C,MAAAA,CAAC,CAACa,cAAF;AACH;;AACD,aAASC,IAAT,GAAgB;AACZ,YAAM;AAAEpE,QAAAA,KAAK,EAAE4D;AAAT,UAA2B5B,cAAjC;;AACA,UAAI4B,aAAJ,EAAmB;AACfrB,QAAAA,gBAAgB,CAACqB,aAAa,CAACS,OAAd,CAAsB;AAAEC,UAAAA,IAAI,EAAE;AAAR,SAAtB,CAAD,EAAwC,IAAxC,CAAhB;AACH;AACJ;;AACD,aAASC,IAAT,GAAgB;AACZ,YAAM;AAAEvE,QAAAA,KAAK,EAAE4D;AAAT,UAA2B5B,cAAjC;;AACA,UAAI4B,aAAJ,EAAmB;AACfrB,QAAAA,gBAAgB,CAACqB,aAAa,CAACY,OAAd,CAAsB;AAAEF,UAAAA,IAAI,EAAE;AAAR,SAAtB,CAAD,EAAwC,IAAxC,CAAhB;AACH;AACJ;;AACD,aAAS/B,gBAAT,CAA0Ba,MAA1B,EAAkCC,QAAQ,GAAG,KAA7C,EAAoD;AAChDrB,MAAAA,cAAc,CAAChC,KAAf,GAAuBoD,MAAvB;AACA,UAAIC,QAAJ,EACIZ,mBAAmB;AAC1B;;AACD,aAASA,mBAAT,GAA+B;AAC3B,UAAIe,EAAJ,EAAQiB,EAAR;;AACA,YAAMrB,MAAM,GAAGpB,cAAc,CAAChC,KAA9B;AACA,UAAI,CAACoD,MAAL,EACI;AACJ,YAAMsB,MAAM,GAAG3C,eAAe,CAAC/B,KAAhB,CAAsBoD,MAAM,CAACuB,GAA7B,CAAf;AACA,UAAID,MAAM,KAAK,IAAf,EACI;;AACJ,UAAIvF,KAAK,CAACkB,aAAV,EAAyB;AACrB,SAACmD,EAAE,GAAG7B,cAAc,CAAC3B,KAArB,MAAgC,IAAhC,IAAwCwD,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAACoB,QAAH,CAAY;AAAEC,UAAAA,KAAK,EAAEH;AAAT,SAAZ,CAAjE;AACH,OAFD,MAGK;AACD,SAACD,EAAE,GAAG7C,YAAY,CAAC5B,KAAnB,MAA8B,IAA9B,IAAsCyE,EAAE,KAAK,KAAK,CAAlD,GAAsD,KAAK,CAA3D,GAA+DA,EAAE,CAACG,QAAH,CAAY;AACvEC,UAAAA,KAAK,EAAEH,MADgE;AAEvEI,UAAAA,MAAM,EAAEnC,WAAW,CAAC3C;AAFmD,SAAZ,CAA/D;AAIH;AACJ;;AACD,aAAS+E,aAAT,CAAuBzB,CAAvB,EAA0B;AACtB,UAAIE,EAAJ,EAAQiB,EAAR;;AACA,UAAI,CAACjB,EAAE,GAAG9B,OAAO,CAAC1B,KAAd,MAAyB,IAAzB,IAAiCwD,EAAE,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,EAAE,CAACwB,QAAH,CAAY1B,CAAC,CAAC2B,MAAd,CAA9D,EAAqF;AACjF,SAACR,EAAE,GAAGtF,KAAK,CAAC2B,OAAZ,MAAyB,IAAzB,IAAiC2D,EAAE,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,EAAE,CAACT,IAAH,CAAQ7E,KAAR,EAAemE,CAAf,CAA1D;AACH;AACJ;;AACD,aAAS4B,cAAT,CAAwB5B,CAAxB,EAA2B;AACvB,UAAIE,EAAJ,EAAQiB,EAAR;;AACA,UAAI,EAAE,CAACjB,EAAE,GAAG9B,OAAO,CAAC1B,KAAd,MAAyB,IAAzB,IAAiCwD,EAAE,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,EAAE,CAACwB,QAAH,CAAY1B,CAAC,CAAC6B,aAAd,CAA5D,CAAJ,EAA+F;AAC3F,SAACV,EAAE,GAAGtF,KAAK,CAAC4B,MAAZ,MAAwB,IAAxB,IAAgC0D,EAAE,KAAK,KAAK,CAA5C,GAAgD,KAAK,CAArD,GAAyDA,EAAE,CAACT,IAAH,CAAQ7E,KAAR,EAAemE,CAAf,CAAzD;AACH;AACJ;;AACD5F,IAAAA,OAAO,CAACqB,iCAAD,EAAoC;AACvC8E,MAAAA,sBADuC;AAEvCC,MAAAA,iBAFuC;AAGvChB,MAAAA,WAHuC;AAIvCsC,MAAAA,WAAW,EAAE3H,KAAK,CAAC0B,KAAD,EAAQ,UAAR,CAJqB;AAKvCkG,MAAAA,QAAQ,EAAE5H,KAAK,CAAC0B,KAAD,EAAQ,OAAR,CALwB;AAMvCmG,MAAAA,cAAc,EAAE7H,KAAK,CAAC0B,KAAD,EAAQ,aAAR,CANkB;AAOvCoG,MAAAA,eAAe,EAAE9H,KAAK,CAAC0B,KAAD,EAAQ,cAAR,CAPiB;AAQvCqG,MAAAA,gBAAgB,EAAExD;AARqB,KAApC,CAAP;AAUAtE,IAAAA,OAAO,CAACsB,qCAAD,EAAwC0C,OAAxC,CAAP;AACApE,IAAAA,SAAS,CAAC,MAAM;AACZ,YAAM;AAAE0C,QAAAA;AAAF,UAAY4B,YAAlB;AACA,UAAI5B,KAAJ,EACIA,KAAK,CAACyD,IAAN;AACP,KAJQ,CAAT;AAKA,UAAMgC,UAAU,GAAGlI,QAAQ,CAAC,MAAM;AAC9B,YAAM;AAAEwC,QAAAA;AAAF,UAAWZ,KAAjB;AACA,YAAM;AAAEuG,QAAAA,MAAM,EAAE;AAAEC,UAAAA;AAAF,SAAV;AAAoC/C,QAAAA,IAAI,EAAE;AAAEgD,UAAAA,MAAF;AAAUC,UAAAA,YAAV;AAAwBC,UAAAA,KAAxB;AAA+BC,UAAAA,oBAA/B;AAAqDC,UAAAA,kBAArD;AAAyEC,UAAAA,sBAAzE;AAAiGC,UAAAA,eAAjG;AAAkHC,UAAAA,uBAAlH;AAA2IC,UAAAA,qBAA3I;AAAkKC,UAAAA,qBAAlK;AAAyLC,UAAAA,gBAAzL;AAA2MC,UAAAA,eAA3M;AAA4NC,UAAAA,kBAA5N;AAAgPC,UAAAA,iBAAhP;AAAmQC,UAAAA,YAAnQ;AAAiRC,UAAAA,WAAjR;AAA8R,WAACpI,SAAS,CAAC,gBAAD,EAAmBwB,IAAnB,CAAV,GAAqC6G,QAAnU;AAA6U,WAACrI,SAAS,CAAC,cAAD,EAAiBwB,IAAjB,CAAV,GAAmC8G,YAAhX;AAA8X,WAACtI,SAAS,CAAC,eAAD,EAAkBwB,IAAlB,CAAV,GAAoC+G;AAAla;AAA1C,UAAgerF,QAAQ,CAACzB,KAA/e;AACA,aAAO;AACH,sBAAc4F,MADX;AAEH,oCAA4BI,kBAFzB;AAGH,iCAAyBO,eAHtB;AAIH,sBAAcZ,oBAJX;AAKH,6BAAqBE,YALlB;AAMH,qBAAaC,KANV;AAOH,gCAAwBc,QAPrB;AAQH,uCAA+Bb,oBAR5B;AASH,kCAA0BO,gBATvB;AAUH,oCAA4BE,kBAVzB;AAWH,mCAA2BC,iBAXxB;AAYH,6BAAqBI,YAZlB;AAaH,uCAA+BR,qBAb5B;AAcH,iCAAyBH,eAdtB;AAeH,wCAAgCE,qBAf7B;AAgBH,0CAAkCD,uBAhB/B;AAiBH,yCAAiCF,sBAjB9B;AAkBH,8BAAsBa,aAlBnB;AAmBH,mCAA2B9I,UAAU,CAAC8I,aAAD,EAAgB,MAAhB,CAnBlC;AAoBH,6BAAqBJ,YApBlB;AAqBH,4BAAoBC;AArBjB,OAAP;AAuBH,KA1B0B,CAA3B;AA2BA,UAAM;AAAErF,MAAAA;AAAF,QAA0BnC,KAAhC;AACA,UAAM4H,gBAAgB,GAAGzF,mBAAmB,GACtC9C,aAAa,CAAC,sBAAD,EAAyBjB,QAAQ,CAAC,MAAM4B,KAAK,CAACY,IAAN,CAAW,CAAX,CAAP,CAAjC,EAAwD0F,UAAxD,EAAoEtG,KAApE,CADyB,GAEtC6H,SAFN;AAGA,UAAMC,YAAY,GAAG;AACjBvF,MAAAA,OADiB;AAEjB0C,MAAAA,IAFiB;AAGjBG,MAAAA,IAHiB;AAIjBZ,MAAAA;AAJiB,KAArB;AAMA,WAAOvE,MAAM,CAACC,MAAP,CAAc;AAAE6H,MAAAA,WAAW,EAAEzF,QAAf;AAAyBE,MAAAA,cAAzB;AACjBC,MAAAA,YADiB;AACHuF,MAAAA,QAAQ,EAAExE,WADP;AACoByE,MAAAA,OAAO,EAAEvE,UAD7B;AACyCwE,MAAAA,cAAc,EAAExF,iBADzD;AAC4EyF,MAAAA,KAAK,EAAErE,QADnF;;AAC6FsE,MAAAA,oBAAoB,GAAG;AACjI,cAAM;AAAEvH,UAAAA;AAAF,YAAY2B,cAAlB;AACA,eAAO3B,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,KAAK,CAAjC,GAAqC,KAAK,CAA1C,GAA8CA,KAAK,CAACwH,SAA3D;AACH,OAJgB;;AAKjBC,MAAAA,kBAAkB,GAAG;AACjB,cAAM;AAAEzH,UAAAA;AAAF,YAAY2B,cAAlB;AACA,eAAO3B,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,KAAK,CAAjC,GAAqC,KAAK,CAA1C,GAA8CA,KAAK,CAAC0H,UAA3D;AACH,OARgB;;AASjBrE,MAAAA,QATiB;AAUjB0B,MAAAA,aAViB;AAWjBG,MAAAA,cAXiB;AAYjBnB,MAAAA,WAZiB;AAajBE,MAAAA,aAbiB;AAcjBC,MAAAA,eAdiB;AAejBR,MAAAA,uBAfiB;AAgBjBH,MAAAA,uBAhBiB;AAgBQoE,MAAAA,OAAO,EAAErG,mBAAmB,GAAG0F,SAAH,GAAevB,UAhBnD;AAgB+DmC,MAAAA,UAAU,EAAEb,gBAAgB,KAAK,IAArB,IAA6BA,gBAAgB,KAAK,KAAK,CAAvD,GAA2D,KAAK,CAAhE,GAAoEA,gBAAgB,CAACa,UAhBhK;AAgB4KC,MAAAA,QAAQ,EAAEd,gBAAgB,KAAK,IAArB,IAA6BA,gBAAgB,KAAK,KAAK,CAAvD,GAA2D,KAAK,CAAhE,GAAoEA,gBAAgB,CAACc;AAhB3Q,KAAd,EAgBqSZ,YAhBrS,CAAP;AAiBH,GA9Q0B;;AA+Q3Ba,EAAAA,MAAM,GAAG;AACL,UAAM;AAAEC,MAAAA,MAAF;AAAU1H,MAAAA,aAAV;AAAyBf,MAAAA,SAAzB;AAAoC4H,MAAAA,WAApC;AAAiDU,MAAAA,UAAjD;AAA6DC,MAAAA;AAA7D,QAA0E,IAAhF;AACAA,IAAAA,QAAQ,KAAK,IAAb,IAAqBA,QAAQ,KAAK,KAAK,CAAvC,GAA2C,KAAK,CAAhD,GAAoDA,QAAQ,EAA5D;AACA,WAAQzK,CAAC,CAAC,KAAD,EAAQ;AAAEC,MAAAA,GAAG,EAAE,SAAP;AAAkB2K,MAAAA,QAAQ,EAAE,KAAKxH,SAAL,GAAiB,CAAjB,GAAqB,CAAC,CAAlD;AAAqDyH,MAAAA,KAAK,EAAE,CACpE,GAAE3I,SAAU,mBADwD,EAErEsI,UAFqE,EAGrE,KAAK9H,QAAL,IAAkB,GAAER,SAAU,6BAHuC,CAA5D;AAIVL,MAAAA,KAAK,EAAE,CACN;AAAEkB,QAAAA,KAAK,EAAE/B,YAAY,CAAC,KAAK+B,KAAN;AAArB,OADM,EAEN,KAAKwH,OAFC,CAJG;AAOVO,MAAAA,SAAS,EAAE,KAAKnD,aAPN;AAOqBoD,MAAAA,UAAU,EAAE,KAAKjD,cAPtC;AAOsDlE,MAAAA,OAAO,EAAE,KAAK+C,WAPpE;AAOiF9C,MAAAA,SAAS,EAAE,KAAKgD,aAPjG;AAOgHrD,MAAAA,WAAW,EAAE,KAAKsD,eAPlI;AAOmJ/C,MAAAA,YAAY,EAAE,KAAKA,YAPtK;AAOoLC,MAAAA,YAAY,EAAE,KAAKA;AAPvM,KAAR,EAQL,KAAKb,OAAL,GAAgBnD,CAAC,CAAC,KAAD,EAAQ;AAAE6K,MAAAA,KAAK,EAAG,GAAE3I,SAAU;AAAtB,KAAR,EACblC,CAAC,CAACsB,gBAAD,EAAmB;AAAEY,MAAAA,SAAS,EAAEA,SAAb;AAAwB8I,MAAAA,WAAW,EAAE;AAArC,KAAnB,CADY,CAAjB,GACuE,CAAC,KAAKd,KAAN,GAAelK,CAAC,CAACe,UAAD,EAAa;AAAEd,MAAAA,GAAG,EAAE,cAAP;AAAuBgL,MAAAA,KAAK,EAAEnB,WAAW,CAACoB,KAAZ,CAAkBC,SAAhD;AAA2DC,MAAAA,cAAc,EAAEtB,WAAW,CAACuB,aAAZ,CAA0BF,SAArG;AAAgH7I,MAAAA,UAAU,EAAE,KAAKA,UAAjI;AAA6IgJ,MAAAA,SAAS,EAAErI,aAAa,GAAG,KAAKkH,oBAAR,GAA+BP,SAApM;AAA+M2B,MAAAA,OAAO,EAAEtI,aAAa,GAAG,KAAKoH,kBAAR,GAA6BT,SAAlQ;AAA6QnG,MAAAA,QAAQ,EAAER,aAAa,GAAG2G,SAAH,GAAe,KAAK3D;AAAxT,KAAb,EAAiV;AACpazD,MAAAA,OAAO,EAAE,MAAM;AACX,eAAOS,aAAa,GAAIjD,CAAC,CAACU,WAAD,EAAc;AAAET,UAAAA,GAAG,EAAE,gBAAP;AAAyB4K,UAAAA,KAAK,EAAG,GAAE3I,SAAU,eAA7C;AAA6DsJ,UAAAA,KAAK,EAAE,KAAKvB,cAAzE;AAAyFF,UAAAA,QAAQ,EAAE,KAAKA,QAAxG;AAAkH0B,UAAAA,aAAa,EAAE,KAAjI;AAAwIC,UAAAA,UAAU,EAAE,KAAK1B,OAAL,CAAa2B,GAAjK;AAAsKC,UAAAA,aAAa,EAAE,KAAK5B,OAAL,CAAa6B,MAAlM;AAA0MC,UAAAA,QAAQ,EAAE,KAAKxF,uBAAzN;AAAkP7C,UAAAA,QAAQ,EAAE,KAAK0C,uBAAjQ;AAA0R4F,UAAAA,aAAa,EAAE;AAAzS,SAAd,EAA+T;AACpVvJ,UAAAA,OAAO,EAAE,CAAC;AAAEwJ,YAAAA,IAAI,EAAEhG;AAAR,WAAD,KAAsB;AAC3B,mBAAOA,MAAM,CAACiG,OAAP,GAAkBjM,CAAC,CAAC0B,kBAAD,EAAqB;AAAE6F,cAAAA,GAAG,EAAEvB,MAAM,CAACuB,GAAd;AAAmBrF,cAAAA,SAAS,EAAEA,SAA9B;AAAyC8D,cAAAA,MAAM,EAAEA;AAAjD,aAArB,CAAnB,GAAsGA,MAAM,CAACkG,OAAP,GAAiB,IAAjB,GAAyBlM,CAAC,CAACyB,aAAD,EAAgB;AAAES,cAAAA,SAAS,EAAEA,SAAb;AAAwBqF,cAAAA,GAAG,EAAEvB,MAAM,CAACuB,GAApC;AAAyCvB,cAAAA,MAAM,EAAEA;AAAjD,aAAhB,CAAvI;AACH;AAHmV,SAA/T,CAAL,GAIbhG,CAAC,CAAC,KAAD,EAAQ;AAAE6K,UAAAA,KAAK,EAAG,GAAE3I,SAAU,kCAAtB;AAAyDL,UAAAA,KAAK,EAAE;AACxE6J,YAAAA,UAAU,EAAE,KAAK1B,OAAL,CAAa2B,GAD+C;AAExEC,YAAAA,aAAa,EAAE,KAAK5B,OAAL,CAAa6B;AAF4C;AAAhE,SAAR,EAGC,KAAK5B,cAAL,CAAoBkC,GAApB,CAAyBnG,MAAD,IAAYA,MAAM,CAACiG,OAAP,GAAkBjM,CAAC,CAAC0B,kBAAD,EAAqB;AAAE6F,UAAAA,GAAG,EAAEvB,MAAM,CAACuB,GAAd;AAAmBrF,UAAAA,SAAS,EAAEA,SAA9B;AAAyC8D,UAAAA,MAAM,EAAEA;AAAjD,SAArB,CAAnB,GAAuGhG,CAAC,CAACyB,aAAD,EAAgB;AAAES,UAAAA,SAAS,EAAEA,SAAb;AAAwBqF,UAAAA,GAAG,EAAEvB,MAAM,CAACuB,GAApC;AAAyCvB,UAAAA,MAAM,EAAEA;AAAjD,SAAhB,CAA5I,CAHD,CAJR;AAQH;AAVma,KAAjV,CAAhB,GAWhEhG,CAAC,CAAC,KAAD,EAAQ;AAAE6K,MAAAA,KAAK,EAAG,GAAE3I,SAAU;AAAtB,KAAR,EAA2DjB,WAAW,CAAC0J,MAAM,CAACT,KAAR,EAAe,MAAM,CAC/FlK,CAAC,CAACc,MAAD,EAAS;AAAEmK,MAAAA,KAAK,EAAEnB,WAAW,CAACoB,KAAZ,CAAkBkB,KAA3B;AAAkChB,MAAAA,cAAc,EAAEtB,WAAW,CAACuB,aAAZ,CAA0Be;AAA5E,KAAT,CAD8F,CAArB,CAAtE,CApBH,EAuBLlL,kBAAkB,CAACyJ,MAAM,CAAC0B,MAAR,EAAiBC,QAAD,IAAcA,QAAQ,IAAI,CACxDtM,CAAC,CAAC,KAAD,EAAQ;AAAE6K,MAAAA,KAAK,EAAG,GAAE3I,SAAU,2BAAtB;AAAkD,qBAAe,IAAjE;AAAuEqF,MAAAA,GAAG,EAAE;AAA5E,KAAR,EAAgG+E,QAAhG,CADuD,EAExDtM,CAAC,CAACuB,cAAD,EAAiB;AAAEmC,MAAAA,OAAO,EAAE,KAAKI,QAAhB;AAA0ByD,MAAAA,GAAG,EAAE;AAA/B,KAAjB,CAFuD,CAA1C,CAvBb,CAAT;AA2BH;;AA7S0B,CAAD,CAA9B","sourcesContent":["import { h, ref, onMounted, computed, defineComponent, toRef, provide, nextTick, watch } from 'vue';\nimport { createIndexGetter } from 'treemate';\nimport { VirtualList } from 'vueuc';\nimport { depx, getPadding, happensIn } from 'seemly';\nimport { NEmpty } from '../../../empty';\nimport { NScrollbar } from '../../scrollbar';\nimport { formatLength, resolveSlot, resolveWrappedSlot } from '../../../_utils';\nimport { createKey } from '../../../_utils/cssr';\nimport { useThemeClass, useTheme } from '../../../_mixins';\nimport NInternalLoading from '../../loading';\nimport NFocusDetector from '../../focus-detector';\nimport { internalSelectMenuLight } from '../styles';\nimport NSelectOption from './SelectOption';\nimport NSelectGroupHeader from './SelectGroupHeader';\nimport { internalSelectionMenuInjectionKey, internalSelectionMenuBodyInjectionKey } from './interface';\nimport style from './styles/index.cssr';\nexport default defineComponent({\n    name: 'InternalSelectMenu',\n    props: Object.assign(Object.assign({}, useTheme.props), { clsPrefix: {\n            type: String,\n            required: true\n        }, scrollable: {\n            type: Boolean,\n            default: true\n        }, treeMate: {\n            type: Object,\n            required: true\n        }, multiple: Boolean, size: {\n            type: String,\n            default: 'medium'\n        }, value: {\n            type: [String, Number, Array],\n            default: null\n        }, width: [Number, String], autoPending: Boolean, virtualScroll: {\n            type: Boolean,\n            default: true\n        }, \n        // show is used to toggle pending state initialization\n        show: {\n            type: Boolean,\n            default: true\n        }, loading: Boolean, focusable: Boolean, renderLabel: Function, renderOption: Function, onMousedown: Function, onScroll: Function, onFocus: Function, onBlur: Function, onKeyup: Function, onKeydown: Function, onTabOut: Function, onMouseenter: Function, onMouseleave: Function, resetMenuOnOptionsChange: {\n            type: Boolean,\n            default: true\n        }, inlineThemeDisabled: Boolean, \n        // deprecated\n        onToggle: Function }),\n    setup(props) {\n        const themeRef = useTheme('InternalSelectMenu', '-internal-select-menu', style, internalSelectMenuLight, props, toRef(props, 'clsPrefix'));\n        const selfRef = ref(null);\n        const virtualListRef = ref(null);\n        const scrollbarRef = ref(null);\n        const flattenedNodesRef = computed(() => props.treeMate.getFlattenedNodes());\n        const fIndexGetterRef = computed(() => createIndexGetter(flattenedNodesRef.value));\n        const pendingNodeRef = ref(null);\n        function initPendingNode() {\n            const { treeMate } = props;\n            let defaultPendingNode = null;\n            if (props.autoPending) {\n                const { value } = props;\n                if (value === null) {\n                    defaultPendingNode = treeMate.getFirstAvailableNode();\n                }\n                else {\n                    if (props.multiple) {\n                        defaultPendingNode = treeMate.getNode((value || [])[(value || []).length - 1]);\n                    }\n                    else {\n                        defaultPendingNode = treeMate.getNode(value);\n                    }\n                    if (!defaultPendingNode || defaultPendingNode.disabled) {\n                        defaultPendingNode = treeMate.getFirstAvailableNode();\n                    }\n                }\n                if (defaultPendingNode) {\n                    setPendingTmNode(defaultPendingNode);\n                }\n            }\n        }\n        let initPendingNodeWatchStopHandle;\n        watch(toRef(props, 'show'), (value) => {\n            if (value) {\n                initPendingNodeWatchStopHandle = watch(props.resetMenuOnOptionsChange\n                    ? [toRef(props, 'treeMate'), toRef(props, 'multiple')]\n                    : [toRef(props, 'multiple')], () => {\n                    initPendingNode();\n                    void nextTick(scrollToPendingNode);\n                }, {\n                    immediate: true\n                });\n            }\n            else {\n                initPendingNodeWatchStopHandle === null || initPendingNodeWatchStopHandle === void 0 ? void 0 : initPendingNodeWatchStopHandle();\n            }\n        }, {\n            immediate: true\n        });\n        const itemSizeRef = computed(() => {\n            return depx(themeRef.value.self[createKey('optionHeight', props.size)]);\n        });\n        const paddingRef = computed(() => {\n            return getPadding(themeRef.value.self[createKey('padding', props.size)]);\n        });\n        const valueSetRef = computed(() => {\n            if (props.multiple && Array.isArray(props.value)) {\n                return new Set(props.value);\n            }\n            return new Set();\n        });\n        const emptyRef = computed(() => {\n            const tmNodes = flattenedNodesRef.value;\n            return tmNodes && tmNodes.length === 0;\n        });\n        function doToggle(tmNode) {\n            const { onToggle } = props;\n            if (onToggle)\n                onToggle(tmNode);\n        }\n        function doScroll(e) {\n            const { onScroll } = props;\n            if (onScroll)\n                onScroll(e);\n        }\n        // required, scroller sync need to be triggered manually\n        function handleVirtualListScroll(e) {\n            var _a;\n            (_a = scrollbarRef.value) === null || _a === void 0 ? void 0 : _a.sync();\n            doScroll(e);\n        }\n        function handleVirtualListResize() {\n            var _a;\n            (_a = scrollbarRef.value) === null || _a === void 0 ? void 0 : _a.sync();\n        }\n        function getPendingTmNode() {\n            const { value: pendingTmNode } = pendingNodeRef;\n            if (pendingTmNode)\n                return pendingTmNode;\n            return null;\n        }\n        function handleOptionMouseEnter(e, tmNode) {\n            if (tmNode.disabled)\n                return;\n            setPendingTmNode(tmNode, false);\n        }\n        function handleOptionClick(e, tmNode) {\n            if (tmNode.disabled)\n                return;\n            doToggle(tmNode);\n        }\n        // keyboard related methods\n        function handleKeyUp(e) {\n            var _a;\n            if (happensIn(e, 'action'))\n                return;\n            (_a = props.onKeyup) === null || _a === void 0 ? void 0 : _a.call(props, e);\n        }\n        function handleKeyDown(e) {\n            var _a;\n            if (happensIn(e, 'action'))\n                return;\n            (_a = props.onKeydown) === null || _a === void 0 ? void 0 : _a.call(props, e);\n        }\n        function handleMouseDown(e) {\n            var _a;\n            (_a = props.onMousedown) === null || _a === void 0 ? void 0 : _a.call(props, e);\n            if (props.focusable)\n                return;\n            e.preventDefault();\n        }\n        function next() {\n            const { value: pendingTmNode } = pendingNodeRef;\n            if (pendingTmNode) {\n                setPendingTmNode(pendingTmNode.getNext({ loop: true }), true);\n            }\n        }\n        function prev() {\n            const { value: pendingTmNode } = pendingNodeRef;\n            if (pendingTmNode) {\n                setPendingTmNode(pendingTmNode.getPrev({ loop: true }), true);\n            }\n        }\n        function setPendingTmNode(tmNode, doScroll = false) {\n            pendingNodeRef.value = tmNode;\n            if (doScroll)\n                scrollToPendingNode();\n        }\n        function scrollToPendingNode() {\n            var _a, _b;\n            const tmNode = pendingNodeRef.value;\n            if (!tmNode)\n                return;\n            const fIndex = fIndexGetterRef.value(tmNode.key);\n            if (fIndex === null)\n                return;\n            if (props.virtualScroll) {\n                (_a = virtualListRef.value) === null || _a === void 0 ? void 0 : _a.scrollTo({ index: fIndex });\n            }\n            else {\n                (_b = scrollbarRef.value) === null || _b === void 0 ? void 0 : _b.scrollTo({\n                    index: fIndex,\n                    elSize: itemSizeRef.value\n                });\n            }\n        }\n        function handleFocusin(e) {\n            var _a, _b;\n            if ((_a = selfRef.value) === null || _a === void 0 ? void 0 : _a.contains(e.target)) {\n                (_b = props.onFocus) === null || _b === void 0 ? void 0 : _b.call(props, e);\n            }\n        }\n        function handleFocusout(e) {\n            var _a, _b;\n            if (!((_a = selfRef.value) === null || _a === void 0 ? void 0 : _a.contains(e.relatedTarget))) {\n                (_b = props.onBlur) === null || _b === void 0 ? void 0 : _b.call(props, e);\n            }\n        }\n        provide(internalSelectionMenuInjectionKey, {\n            handleOptionMouseEnter,\n            handleOptionClick,\n            valueSetRef,\n            multipleRef: toRef(props, 'multiple'),\n            valueRef: toRef(props, 'value'),\n            renderLabelRef: toRef(props, 'renderLabel'),\n            renderOptionRef: toRef(props, 'renderOption'),\n            pendingTmNodeRef: pendingNodeRef\n        });\n        provide(internalSelectionMenuBodyInjectionKey, selfRef);\n        onMounted(() => {\n            const { value } = scrollbarRef;\n            if (value)\n                value.sync();\n        });\n        const cssVarsRef = computed(() => {\n            const { size } = props;\n            const { common: { cubicBezierEaseInOut }, self: { height, borderRadius, color, groupHeaderTextColor, actionDividerColor, optionTextColorPressed, optionTextColor, optionTextColorDisabled, optionTextColorActive, optionOpacityDisabled, optionCheckColor, actionTextColor, optionColorPending, optionColorActive, loadingColor, loadingSize, [createKey('optionFontSize', size)]: fontSize, [createKey('optionHeight', size)]: optionHeight, [createKey('optionPadding', size)]: optionPadding } } = themeRef.value;\n            return {\n                '--n-height': height,\n                '--n-action-divider-color': actionDividerColor,\n                '--n-action-text-color': actionTextColor,\n                '--n-bezier': cubicBezierEaseInOut,\n                '--n-border-radius': borderRadius,\n                '--n-color': color,\n                '--n-option-font-size': fontSize,\n                '--n-group-header-text-color': groupHeaderTextColor,\n                '--n-option-check-color': optionCheckColor,\n                '--n-option-color-pending': optionColorPending,\n                '--n-option-color-active': optionColorActive,\n                '--n-option-height': optionHeight,\n                '--n-option-opacity-disabled': optionOpacityDisabled,\n                '--n-option-text-color': optionTextColor,\n                '--n-option-text-color-active': optionTextColorActive,\n                '--n-option-text-color-disabled': optionTextColorDisabled,\n                '--n-option-text-color-pressed': optionTextColorPressed,\n                '--n-option-padding': optionPadding,\n                '--n-option-padding-left': getPadding(optionPadding, 'left'),\n                '--n-loading-color': loadingColor,\n                '--n-loading-size': loadingSize\n            };\n        });\n        const { inlineThemeDisabled } = props;\n        const themeClassHandle = inlineThemeDisabled\n            ? useThemeClass('internal-select-menu', computed(() => props.size[0]), cssVarsRef, props)\n            : undefined;\n        const exposedProps = {\n            selfRef,\n            next,\n            prev,\n            getPendingTmNode\n        };\n        return Object.assign({ mergedTheme: themeRef, virtualListRef,\n            scrollbarRef, itemSize: itemSizeRef, padding: paddingRef, flattenedNodes: flattenedNodesRef, empty: emptyRef, virtualListContainer() {\n                const { value } = virtualListRef;\n                return value === null || value === void 0 ? void 0 : value.listElRef;\n            },\n            virtualListContent() {\n                const { value } = virtualListRef;\n                return value === null || value === void 0 ? void 0 : value.itemsElRef;\n            },\n            doScroll,\n            handleFocusin,\n            handleFocusout,\n            handleKeyUp,\n            handleKeyDown,\n            handleMouseDown,\n            handleVirtualListResize,\n            handleVirtualListScroll, cssVars: inlineThemeDisabled ? undefined : cssVarsRef, themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass, onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender }, exposedProps);\n    },\n    render() {\n        const { $slots, virtualScroll, clsPrefix, mergedTheme, themeClass, onRender } = this;\n        onRender === null || onRender === void 0 ? void 0 : onRender();\n        return (h(\"div\", { ref: \"selfRef\", tabindex: this.focusable ? 0 : -1, class: [\n                `${clsPrefix}-base-select-menu`,\n                themeClass,\n                this.multiple && `${clsPrefix}-base-select-menu--multiple`\n            ], style: [\n                { width: formatLength(this.width) },\n                this.cssVars\n            ], onFocusin: this.handleFocusin, onFocusout: this.handleFocusout, onKeyup: this.handleKeyUp, onKeydown: this.handleKeyDown, onMousedown: this.handleMouseDown, onMouseenter: this.onMouseenter, onMouseleave: this.onMouseleave },\n            this.loading ? (h(\"div\", { class: `${clsPrefix}-base-select-menu__loading` },\n                h(NInternalLoading, { clsPrefix: clsPrefix, strokeWidth: 20 }))) : !this.empty ? (h(NScrollbar, { ref: \"scrollbarRef\", theme: mergedTheme.peers.Scrollbar, themeOverrides: mergedTheme.peerOverrides.Scrollbar, scrollable: this.scrollable, container: virtualScroll ? this.virtualListContainer : undefined, content: virtualScroll ? this.virtualListContent : undefined, onScroll: virtualScroll ? undefined : this.doScroll }, {\n                default: () => {\n                    return virtualScroll ? (h(VirtualList, { ref: \"virtualListRef\", class: `${clsPrefix}-virtual-list`, items: this.flattenedNodes, itemSize: this.itemSize, showScrollbar: false, paddingTop: this.padding.top, paddingBottom: this.padding.bottom, onResize: this.handleVirtualListResize, onScroll: this.handleVirtualListScroll, itemResizable: true }, {\n                        default: ({ item: tmNode }) => {\n                            return tmNode.isGroup ? (h(NSelectGroupHeader, { key: tmNode.key, clsPrefix: clsPrefix, tmNode: tmNode })) : tmNode.ignored ? null : (h(NSelectOption, { clsPrefix: clsPrefix, key: tmNode.key, tmNode: tmNode }));\n                        }\n                    })) : (h(\"div\", { class: `${clsPrefix}-base-select-menu-option-wrapper`, style: {\n                            paddingTop: this.padding.top,\n                            paddingBottom: this.padding.bottom\n                        } }, this.flattenedNodes.map((tmNode) => tmNode.isGroup ? (h(NSelectGroupHeader, { key: tmNode.key, clsPrefix: clsPrefix, tmNode: tmNode })) : (h(NSelectOption, { clsPrefix: clsPrefix, key: tmNode.key, tmNode: tmNode })))));\n                }\n            })) : (h(\"div\", { class: `${clsPrefix}-base-select-menu__empty` }, resolveSlot($slots.empty, () => [\n                h(NEmpty, { theme: mergedTheme.peers.Empty, themeOverrides: mergedTheme.peerOverrides.Empty })\n            ]))),\n            resolveWrappedSlot($slots.action, (children) => children && [\n                h(\"div\", { class: `${clsPrefix}-base-select-menu__action`, \"data-action\": true, key: \"action\" }, children),\n                h(NFocusDetector, { onFocus: this.onTabOut, key: \"focus-detector\" })\n            ])));\n    }\n});\n"]},"metadata":{},"sourceType":"module"}