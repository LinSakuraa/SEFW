{"ast":null,"code":"import { useMessage } from 'naive-ui';\nexport default {\n  data() {\n    return {\n      showChoose: false,\n      showReturn: false,\n      user: {},\n      username: '',\n      password: '',\n      repeatPassword: '',\n      showModalUserName: false,\n      showModalPassword: false,\n      ChangeWrongText1: '',\n      ChangeWrongText2: '',\n      ChangeWrongText3: '',\n      wrong1: false,\n      wrong2: false,\n      wrong3: false,\n      booklist: [],\n      returnlist: [],\n      message: useMessage(),\n      temptime: ''\n    };\n  },\n\n  props: {},\n  created: function () {\n    this.user = this.$store.state.user;\n    this.getUserMessage(this.user.userid);\n    this.getUserRecord(this.user.userid);\n  },\n  watch: {},\n  methods: {\n    Change1() {\n      this.showChoose = false;\n      this.showReturn = false;\n    },\n\n    Change2() {\n      this.showChoose = true;\n      this.showReturn = false;\n    },\n\n    Change3() {\n      this.showChoose = false;\n      this.showReturn = true;\n    },\n\n    changeUserName() {\n      this.showModalUserName = true;\n    },\n\n    changePassword() {\n      this.showModalPassword = true;\n    },\n\n    usernameOnBluer() {\n      console.log('usernameOnBluer');\n\n      if (this.username == '') {\n        this.wrong1 = true;\n        this.ChangeWrongText1 = '用户名不能为空';\n      } else {\n        this.wrong1 = false;\n        this.ChangeWrongText1 = '';\n      }\n    },\n\n    passwordOnBluer() {\n      var reg = /^(?=.*[0-9])(?=.*[a-zA-Z]).{6,16}$/;\n\n      if (this.password == '') {\n        this.wrong2 = true;\n        this.ChangeWrongText2 = '密码不能为空';\n      } else if (!reg.test(this.password)) {\n        this.wrong2 = true;\n        this.ChangeWrongText2 = '密码必须包含字母、数字、且位于6-16位之间';\n      } else {\n        this.wrong2 = false;\n        this.ChangeWrongText2 = '';\n      }\n    },\n\n    repeatPasswordOnBluer() {\n      if (this.repeatPassword == '') {\n        this.wrong3 = true;\n        this.ChangeWrongText3 = '确认密码不能为空';\n      } else if (this.password == this.repeatPassword) {\n        this.wrong3 = false;\n        this.ChangeWrongText3 = '';\n      } else {\n        this.wrong3 = true;\n        this.ChangeWrongText3 = '确认密码与密码不一致';\n      }\n    },\n\n    //以下为涉及axios调用的方法\n\n    /****************************************************************/\n    //ajax请求 方法\n    SubmitUserName(userid) {\n      //方法：修改用户名  发送：用户id 新用户名 \n      if (this.wrong1 === false) {\n        this.axios.post('customer/update', {\n          \"cusID\": userid,\n          \"cusName\": this.username\n        }).then(response => {\n          if (response.data == 1) {\n            this.message.success('成功修改用户名！');\n            this.getUserMessage(userid);\n          } else {\n            this.message.error('修改失败!');\n          }\n        }).catch(response => {\n          console.log(response);\n          this.message.error('服务器未响应!');\n        });\n      }\n    },\n\n    SubmitPassword(userid) {\n      //方法：修改密码  发送：用户id 新密码\n      if (this.wrong2 === false && this.wrong3 === false) {\n        this.axios.post('customer/update', {\n          \"cusID\": userid,\n          \"cusPassword\": this.password\n        }).then(response => {\n          if (response.data == 1) {\n            this.message.success('成功修改密码！');\n            this.getUserMessage(userid);\n          } else {\n            this.message.error('修改失败!');\n          }\n        }).catch(response => {\n          console.log(response);\n          this.message.error('服务器未响应!');\n        });\n      }\n    },\n\n    getUserMessage(userid) {\n      if (this.$store.state.isLogin == true) {\n        this.axios.get('customer/find?cusID=' + userid).then(response => {\n          if (response.data.length != 0) {\n            this.$store.state.user.userName = response.data[0].cusName;\n            this.$store.state.user.password = response.data[0].cusPassword;\n            console.log();\n          } else {\n            this.message.error('未能获取用户信息!');\n          }\n        }).catch(response => {\n          this.message.error('服务器未响应!');\n        });\n      } else {\n        this.message.error('未登录！');\n      }\n    },\n\n    getUserRecord(userid) //方法 获取用户借书信息  发送 用户id\n    {\n      //返回结果：书本对象数组\n      this.booklist = [];\n      this.returnlist = [];\n\n      if (this.$store.state.isLogin == true) {\n        this.axios.get('borrow/find?cusID=' + userid).then(response => {\n          console.log(response);\n\n          if (response.data.length != 0) {\n            for (let i = 0; i < response.data.length; i++) {\n              if (response.data[i].state == 0) {\n                this.booklist.push(response.data[i]);\n              } else {\n                this.returnlist.push(response.data[i]);\n              }\n            }\n\n            console.log('booklist');\n            console.log(this.booklist);\n            console.log('returnlist');\n            console.log(this.returnlist);\n          } else {\n            this.message.error('未能获取借书记录!');\n          }\n        }).catch(response => {\n          console.log(response);\n          this.message.error('服务器未响应!');\n        }); //修改booklist\n      } else {\n        this.message.error('未登录！');\n      }\n    },\n\n    returnBook(userid, bookid, borrowDate) //方法 还书请求 发送 用户id 书本id\n    {\n      //返回结果 true/false\n      if (this.$store.state.isLogin == true) {\n        this.axios.post('borrow/update', {\n          \"bookID\": bookid,\n          \"cusID\": userid,\n          \"borrowDate\": borrowDate,\n          \"returnDate\": Date.now(),\n          \"state\": 1\n        }).then(response => {\n          console.log(response);\n\n          if (response.data == 1) {\n            this.message.success('还书成功！');\n          } else {\n            this.message.error('还书失败！');\n          }\n        }).catch(response => {\n          console.log(response);\n          this.message.error('服务器未响应!');\n        }); //修改booklist\n      } else {\n        this.message.error('未登录！');\n      } //请求失败\n\n      /****************************************************************/\n\n    },\n\n    getTime(time) {\n      let date = new Date(time);\n      var Y = date.getFullYear() + '年';\n      var M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '月';\n      var D = date.getDate();\n      D = D < 10 ? '0' + D + '日' + ' ' : D + '日' + ' ';\n      var h = date.getHours();\n      h = h < 10 ? '0' + h + ':' : h + ':';\n      var m = date.getMinutes();\n      m = m < 10 ? '0' + m : m;\n      let a = Y + M + D + h + m;\n      return a;\n    }\n\n  },\n\n  setup() {\n    return {\n      bodyStyle: {\n        width: \"500px\"\n      },\n      bodyStyle2: {\n        width: \"600px\"\n      }\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["useMessage","data","showChoose","showReturn","user","username","password","repeatPassword","showModalUserName","showModalPassword","ChangeWrongText1","ChangeWrongText2","ChangeWrongText3","wrong1","wrong2","wrong3","booklist","returnlist","message","temptime","props","created","$store","state","getUserMessage","userid","getUserRecord","watch","methods","Change1","Change2","Change3","changeUserName","changePassword","usernameOnBluer","console","log","passwordOnBluer","reg","test","repeatPasswordOnBluer","SubmitUserName","axios","post","then","response","success","error","catch","SubmitPassword","isLogin","get","length","userName","cusName","cusPassword","i","push","returnBook","bookid","borrowDate","Date","now","getTime","time","date","Y","getFullYear","M","getMonth","D","getDate","h","getHours","m","getMinutes","a","setup","bodyStyle","width","bodyStyle2"],"sourceRoot":"","sources":["G:\\VUE_FDS\\fluent-vue\\src\\components\\PersonSpace.vue"],"sourcesContent":["<template>\r\n  <div class=\"div-space\">\r\n      <div class=\"space-choose\">\r\n          <n-button  strong secondary type=\"info\"  class=\"choose-button\"  @click=\"Change1\">\r\n            个人信息\r\n          </n-button>\r\n          <n-button  strong secondary type=\"info\"  class=\"choose-button\"  @click=\"Change2\">\r\n            借书情况\r\n          </n-button>\r\n          <n-button  strong secondary type=\"info\"  class=\"choose-button\"  @click=\"Change3\">\r\n            还书情况\r\n          </n-button>\r\n      </div>\r\n      <div class=\"show-space\">\r\n\r\n\r\n        <div class=\"show-data\" v-if=\"showChoose==false&&showReturn==false\">\r\n          <div class=\"data-div\">\r\n            <div class=\"show-list\">\r\n              <div class=\"list-left\">账号</div>\r\n              <div class=\"list-right\">{{user.userid}}</div>\r\n            </div>\r\n            <div class=\"show-list\">\r\n              <div class=\"list-left\">用户名</div>\r\n              <div class=\"list-right\">{{user.userName}}</div>\r\n              <div class=\"change-data\">\r\n                <img src=\"@/assets/change.jpeg\" @click=\"changeUserName\">\r\n              </div>\r\n            </div>\r\n            <div class=\"show-list\">\r\n              <div class=\"list-left\">密码</div>\r\n              <div class=\"list-right\">{{user.password}}</div>\r\n              <div class=\"change-data\">\r\n                <img src=\"@/assets/change.jpeg\" @click=\"changePassword\">\r\n              </div>\r\n            </div>\r\n          </div>\r\n            <n-modal\r\n              v-model:show=\"showModalUserName\"\r\n              class=\"custom-card\"\r\n              preset=\"card\"\r\n              :style=\"bodyStyle\"\r\n              title=\"修改用户名\"\r\n              :mask-closable=\"false\"\r\n              size=\"huge\"\r\n              :bordered=\"false\"\r\n              :segmented=\"segmented\"\r\n              >\r\n              <template #header-extra>\r\n              </template>\r\n              <div class=\"modalA\">\r\n                <div class=\"modal-changeUserName\">\r\n                  <div class=\"input-headtext\">用户名：</div>\r\n                  <input class=\"input-change\" type=\"text\" v-model=\"username\"  placeholder=\"在此处输入用户名\" @blur=\"usernameOnBluer\" />\r\n                  <div v-show=\"this.wrong1==true\" class=\"wrong-text\">{{ChangeWrongText1}}</div>\r\n                </div>\r\n                <div class=\"button-div\">\r\n                 <button class=\"change-button\" @click=\"showModalUserName=false\">取消</button>\r\n                  <button class=\"change-button\" @click=\"SubmitUserName(user.userid)\">确认</button>\r\n                </div>\r\n              </div>\r\n            </n-modal>\r\n\r\n\r\n            <n-modal\r\n              v-model:show=\"showModalPassword\"\r\n              class=\"custom-card\"\r\n              preset=\"card\"\r\n              :style=\"bodyStyle2\"\r\n              title=\"修改用户名\"\r\n              :mask-closable=\"false\"\r\n              size=\"huge\"\r\n              :bordered=\"false\"\r\n              :segmented=\"segmented\"\r\n              >\r\n              <template #header-extra>\r\n              </template>\r\n              <div class=\"modalB\">\r\n                <div class=\"modal-changePassword\">\r\n                    <div class=\"input-headtext\">密码：</div>\r\n                    <input class=\"input-change\" type=\"password\" v-model=\"password\"  placeholder=\"在此处输入密码\" @blur=\"passwordOnBluer();repeatPasswordOnBluer()\" />\r\n                    <div v-show=\"this.wrong2==true\" class=\"wrong-text\">{{ChangeWrongText2}}</div>\r\n                </div>\r\n                <div class=\"modal-changePassword\">\r\n                  <div class=\"input-headtext\">确认密码：</div>\r\n                  <input class=\"input-change\" type=\"password\" v-model=\"repeatPassword\"  placeholder=\"在此处输入确认密码\" @blur=\"repeatPasswordOnBluer();passwordOnBluer()\" />\r\n                  <div v-show=\"this.wrong3==true\" class=\"wrong-text\">{{ChangeWrongText3}}</div>\r\n                </div>\r\n                <div class=\"button-div\">\r\n                 <button class=\"change-button\" @click=\"showModalPassword=false\">取消</button>\r\n                  <button class=\"change-button\" @click=\"SubmitPassword(user.userid)\">确认</button>\r\n                </div>\r\n              </div>\r\n          </n-modal>\r\n        </div>\r\n\r\n\r\n        <div class=\"space-div-book\" v-if=\"showChoose==true\">\r\n          <div class=\"space-book-list\">\r\n          <div class=\"space-book-container\"  v-for=\"book in booklist\" :key=\"book.bookID\">\r\n            <div class=\"space-book-show\">\r\n                <div class=\"space-book-showleft\">书籍编号</div>\r\n                <div class=\"space-book-showright\">{{book.bookID}}</div>\r\n            </div>\r\n            <div class=\"space-book-show\">\r\n                <div class=\"space-book-showleft\">借书时间</div>\r\n                <div class=\"space-book-showright\">{{book.borrowDate}}</div>\r\n            </div>\r\n            <div class=\"space-book-show\">\r\n                <div class=\"space-book-showleft\">借书者账号</div>\r\n                <div class=\"space-book-showright\">{{book.cusID}}</div>\r\n            </div>\r\n            <div class=\"space-book-show\">\r\n              <div style=\"display:flex;justify-content:center;align-items:center; width:100%; height:100%;\">\r\n              <button style=\"height:30px; width:60px\" @click=\"returnBook(user.userid,book.bookID,book.borrowDate)\">还书</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"space-div-book\" v-if=\"showReturn==true\">\r\n          <div class=\"space-book-list\">\r\n          <div class=\"space-book-container\"  v-for=\"returnBook in returnlist\" :key=\"returnBook.bookID\">\r\n            <div class=\"space-book-show\">\r\n                <div class=\"space-book-showleft\">书籍编号</div>\r\n                <div class=\"space-book-showright\">{{returnBook.bookID}}</div>\r\n            </div>\r\n            <div class=\"space-book-show\">\r\n                <div class=\"space-book-showleft\">借书时间</div>\r\n                <div class=\"space-book-showright\">{{returnBook.borrowDate}}</div>\r\n            </div>\r\n            <div class=\"space-book-show\">\r\n                <div class=\"space-book-showleft\">借书者账号</div>\r\n                <div class=\"space-book-showright\">{{returnBook.cusID}}</div>\r\n            </div>\r\n            <div class=\"space-book-show\">\r\n               <div class=\"space-book-showleft\">还书时间</div>\r\n                <div class=\"space-book-showright\">{{getTime(returnBook.returnDate)}}</div>\r\n            </div>\r\n          </div>\r\n          </div>\r\n        </div>\r\n\r\n\r\n      </div>\r\n      \r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { useMessage } from 'naive-ui';\r\nexport default {\r\ndata(){\r\n  return {\r\n    showChoose:false,\r\n    showReturn:false,\r\n    user:{},\r\n    username:'',\r\n    password:'',\r\n    repeatPassword:'',\r\n    showModalUserName:false,\r\n    showModalPassword:false,\r\n    ChangeWrongText1:'',\r\n    ChangeWrongText2:'',\r\n    ChangeWrongText3:'',\r\n    wrong1:false,\r\n    wrong2:false,\r\n    wrong3:false,\r\n    booklist:[],\r\n    returnlist:[],\r\n    message:useMessage(),\r\n    temptime:'',\r\n  }\r\n},props:{},\r\ncreated:function(){\r\n  this.user=this.$store.state.user;\r\n  this.getUserMessage(this.user.userid);\r\n  this.getUserRecord(this.user.userid);\r\n},\r\nwatch:{},\r\nmethods:{\r\n  Change1(){\r\n    this.showChoose = false;\r\n    this.showReturn = false;\r\n  },\r\n  Change2(){\r\n    this.showChoose = true;\r\n    this.showReturn =false;\r\n  },\r\n  Change3(){\r\n     this.showChoose = false;\r\n    this.showReturn = true;\r\n  },\r\n changeUserName(){\r\n    this.showModalUserName=true;\r\n  },\r\n  changePassword(){\r\n    this.showModalPassword=true;\r\n  },\r\n   usernameOnBluer(){\r\n      console.log('usernameOnBluer');\r\n      if(this.username==''){this.wrong1=true;this.ChangeWrongText1='用户名不能为空'}\r\n      else {this.wrong1=false;this.ChangeWrongText1='';}},\r\n    passwordOnBluer(){\r\n      var reg= /^(?=.*[0-9])(?=.*[a-zA-Z]).{6,16}$/;\r\n      if(this.password==''){this.wrong2=true;this.ChangeWrongText2='密码不能为空'}\r\n      else if(!reg.test(this.password)){this.wrong2=true;this.ChangeWrongText2='密码必须包含字母、数字、且位于6-16位之间'}\r\n      else{this.wrong2=false;this.ChangeWrongText2='';}\r\n    },\r\n    repeatPasswordOnBluer(){\r\n      if(this.repeatPassword==''){this.wrong3=true;this.ChangeWrongText3='确认密码不能为空'}\r\n      else if(this.password==this.repeatPassword){this.wrong3=false;this.ChangeWrongText3='';}\r\n      else{this.wrong3=true;this.ChangeWrongText3='确认密码与密码不一致'}\r\n    },\r\n\r\n\r\n\r\n    //以下为涉及axios调用的方法\r\n    /****************************************************************/\r\n    //ajax请求 方法\r\nSubmitUserName(userid){//方法：修改用户名  发送：用户id 新用户名 \r\n\r\n  if(this.wrong1===false)\r\n  {this.axios.post('customer/update',\r\n      {\"cusID\":userid,\r\n      \"cusName\":this.username,\r\n      }).then((response)=>{\r\n        if(response.data==1){\r\n          this.message.success('成功修改用户名！');\r\n          this.getUserMessage(userid);\r\n          }\r\n        else{this.message.error('修改失败!');}\r\n\r\n      }).catch((response)=>{\r\n        console.log( response)\r\n        this.message.error('服务器未响应!');\r\n      })}\r\n}, \r\n\r\nSubmitPassword(userid){//方法：修改密码  发送：用户id 新密码\r\n\r\n   if(this.wrong2===false&&this.wrong3===false){\r\n      this.axios.post('customer/update',\r\n      {\"cusID\":userid,\r\n      \"cusPassword\":this.password,\r\n      }).then((response)=>{\r\n        if(response.data==1){\r\n          this.message.success('成功修改密码！');\r\n          this.getUserMessage(userid);\r\n          }\r\n        else{this.message.error('修改失败!');}\r\n\r\n      }).catch((response)=>{\r\n        console.log( response)\r\n        this.message.error('服务器未响应!');\r\n      })\r\n   }\r\n}, \r\ngetUserMessage(userid)\r\n{\r\n  if(this.$store.state.isLogin==true){\r\n      this.axios.get('customer/find?cusID='+userid).\r\n      then((response)=>{\r\n        if(response.data.length!=0){\r\n          this.$store.state.user.userName=response.data[0].cusName\r\n          this.$store.state.user.password=response.data[0].cusPassword \r\n          console.log()\r\n        }\r\n        else{ this.message.error('未能获取用户信息!');}\r\n\r\n      }).catch((response)=>{\r\n        this.message.error('服务器未响应!');\r\n      })\r\n  }\r\n  else{this.message.error('未登录！')}\r\n},\r\n\r\n getUserRecord(userid)   //方法 获取用户借书信息  发送 用户id\r\n {                      //返回结果：书本对象数组\r\n    this.booklist=[];\r\n    this.returnlist=[];\r\n   if(this.$store.state.isLogin==true){\r\n       this.axios.get('borrow/find?cusID='+userid).\r\n      then((response)=>{\r\n        console.log( response)\r\n        if(response.data.length!=0){\r\n          for(let i=0;i<response.data.length;i++)\r\n         {\r\n            if(response.data[i].state==0)\r\n            {\r\n              this.booklist.push(response.data[i]);\r\n            }\r\n            else{\r\n              this.returnlist.push(response.data[i])\r\n              }\r\n            }\r\n            console.log('booklist');\r\n            console.log(this.booklist);\r\n            console.log('returnlist');\r\n            console.log(this.returnlist);\r\n        }\r\n        else{ this.message.error('未能获取借书记录!');}\r\n\r\n      }).catch((response)=>{\r\n        console.log( response)\r\n        this.message.error('服务器未响应!');\r\n      })\r\n    //修改booklist\r\n   }else{this.message.error('未登录！')}\r\n },\r\n\r\n returnBook(userid,bookid,borrowDate)//方法 还书请求 发送 用户id 书本id\r\n {//返回结果 true/false\r\n  if(this.$store.state.isLogin==true){\r\n       this.axios.post('borrow/update',{\r\n        \"bookID\":bookid,\r\n        \"cusID\":userid,\r\n        \"borrowDate\":borrowDate,\r\n        \"returnDate\":Date.now(),\r\n        \"state\":1,\r\n       }).\r\n      then((response)=>{\r\n        console.log( response)\r\n        if(response.data==1){\r\n          this.message.success('还书成功！');\r\n        }\r\n        else{ this.message.error('还书失败！');}\r\n\r\n      }).catch((response)=>{\r\n        console.log( response)\r\n        this.message.error('服务器未响应!');\r\n      })\r\n    //修改booklist\r\n   }else{this.message.error('未登录！')}\r\n   //请求失败\r\n\r\n/****************************************************************/\r\n },\r\n getTime(time){\r\nlet date = new Date(time);\r\nvar Y = date.getFullYear() + '年';\r\nvar M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '月';\r\nvar D = date.getDate();\r\nD = D<10?'0'+D+ '日'+' ':D+ '日'+' '\r\nvar h = date.getHours();\r\nh = h < 10 ? '0' + h + ':' : h + ':'\r\nvar m = date.getMinutes();\r\nm = m < 10 ? '0' + m : m\r\nlet a = Y + M + D + h + m\r\nreturn a;\r\n }\r\n},\r\n\r\n\r\nsetup(){\r\n  return{\r\n  bodyStyle: {\r\n        width: \"500px\"\r\n      },\r\n  bodyStyle2:{\r\n        width: \"600px\"\r\n  }\r\n  }\r\n}\r\n}\r\n</script>\r\n\r\n<style>\r\n.div-space{\r\n    background-color:#fff;\r\n  height:500px;\r\n  width:100%;\r\n  display:flex;\r\n  align-items: center;\r\n  flex-direction:column;\r\n\r\n}\r\n.space-choose{\r\n  padding-top:10px;\r\n  height:40px;\r\n  width:160px;\r\n  display:flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.choose-button{\r\n  width:80px;\r\n  height:40px;\r\n}\r\n.show-space{\r\n  margin-top:10px;\r\n  width:100%;\r\n}\r\n.show-data{\r\n  display:flex;\r\n  justify-content: center;\r\n}\r\n.data-div{\r\n  border-radius: 10px;\r\n  background-color:#fafafa;\r\n  height:240px;\r\n  display:flex;\r\n  flex-direction: column;\r\n  width:500px;\r\n}\r\n.show-list{\r\n  height:60px;\r\n  width:500px;\r\n  display:flex;\r\n}\r\n.list-left{ \r\n  width:100px;\r\n  display:flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  \r\n}\r\n.list-right{\r\n  width:300px;\r\n  display:flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.change-data{\r\n  padding-left:10px;\r\n  width:60px;\r\n  height:60px;\r\n  display:flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.change-data img{\r\n  height:20px;\r\n  width:20px;\r\n  cursor: pointer;\r\n}\r\n.modal-changeUserName{\r\n  height:100px;\r\n  width:500px;\r\n    display:flex;\r\njustify-content:left;\r\nalign-items:center;\r\n}\r\n.modal-changePassword{\r\n  height:100px;\r\n  width:600px;\r\n    display:flex;\r\njustify-content:left;\r\nalign-items:center;\r\n}\r\n\r\n.input-headtext{\r\n  margin-left:30px;\r\nwidth:100px;\r\nheight:40px;\r\nfont-size:18px;\r\n    display:flex;\r\njustify-content:left;\r\nalign-items:center;\r\n}\r\n\r\n.input-change{\r\nheight:40px;\r\ndisplay:inline-block;\r\nwidth:230px;\r\n}\r\n.wrong-text{\r\n  color:red;\r\n  width:150px;\r\n  height:40px;\r\n  margin-left:10px;\r\n  font-size:14px;\r\ndisplay:flex;\r\njustify-content:left;\r\nalign-items:center;\r\n}\r\n.modalA{\r\n  display:flex;\r\njustify-content:left;\r\nalign-items:center;\r\nflex-direction:column;\r\n}\r\n.button-div{\r\n  height:60px;\r\n  width:100%;\r\n  display:flex;\r\n  justify-content:center;\r\n}\r\n.change-button{\r\nwidth:60px;\r\nheight:30px;\r\nmargin-left:40px;\r\nmargin-right:40px;\r\n}\r\n\r\n.space-div-book{\r\nheight:auto;\r\ndisplay:flex;\r\njustify-content:center;\r\nalign-items:center;\r\nwidth:100%\r\n}\r\n.space-book-list{\r\nwidth:800px;\r\ndisplay:flex;\r\n  flex-wrap:wrap ;\r\n}\r\n.space-book-container{\r\n  display:flex;\r\n  width:240px;\r\n  height:160px;\r\n  flex-direction:column;\r\n  border-radius: 10px;\r\n  background-color:#fafafa;\r\n  margin:10px;\r\n\r\n}\r\n.space-book-show{\r\n  width:100%;\r\n  height:40px;\r\n   display:flex;\r\n}\r\n.space-book-showleft{\r\nwidth:70px;\r\nheight:100%;\r\npadding-left:10px;\r\ndisplay:flex;\r\njustify-content:center;\r\nalign-items:center;\r\n}\r\n.space-book-showright{\r\nwidth:140px;\r\nheight:100%;\r\npadding-left:10px;\r\ndisplay:flex;\r\njustify-content:center;\r\nalign-items:center;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}