{"ast":null,"code":"import { createVNode as _createVNode } from \"vue\";\nimport { computed, defineComponent, ref } from \"vue\";\nimport { addUnit, truthProp, numericProp, preventDefault, makeStringProp, makeNumberProp, makeNumericProp, createNamespace } from \"../utils\";\nimport { useRect, useCustomFieldValue } from \"@vant/use\";\nimport { useRefs } from \"../composables/use-refs\";\nimport { useTouch } from \"../composables/use-touch\";\nimport { Icon } from \"../icon\";\nconst [name, bem] = createNamespace(\"rate\");\n\nfunction getRateStatus(value, index, allowHalf, readonly) {\n  if (value >= index) {\n    return {\n      status: \"full\",\n      value: 1\n    };\n  }\n\n  if (value + 0.5 >= index && allowHalf && !readonly) {\n    return {\n      status: \"half\",\n      value: 0.5\n    };\n  }\n\n  if (value + 1 >= index && allowHalf && readonly) {\n    const cardinal = 10 ** 10;\n    return {\n      status: \"half\",\n      value: Math.round((value - index + 1) * cardinal) / cardinal\n    };\n  }\n\n  return {\n    status: \"void\",\n    value: 0\n  };\n}\n\nconst rateProps = {\n  size: numericProp,\n  icon: makeStringProp(\"star\"),\n  color: String,\n  count: makeNumericProp(5),\n  gutter: numericProp,\n  readonly: Boolean,\n  disabled: Boolean,\n  voidIcon: makeStringProp(\"star-o\"),\n  allowHalf: Boolean,\n  voidColor: String,\n  touchable: truthProp,\n  iconPrefix: String,\n  modelValue: makeNumberProp(0),\n  disabledColor: String\n};\nvar stdin_default = defineComponent({\n  name,\n  props: rateProps,\n  emits: [\"change\", \"update:modelValue\"],\n\n  setup(props, {\n    emit\n  }) {\n    const touch = useTouch();\n    const [itemRefs, setItemRefs] = useRefs();\n    const groupRef = ref();\n\n    const untouchable = () => props.readonly || props.disabled || !props.touchable;\n\n    const list = computed(() => Array(+props.count).fill(\"\").map((_, i) => getRateStatus(props.modelValue, i + 1, props.allowHalf, props.readonly)));\n    let ranges;\n    let groupRefRect;\n    let minRectTop = Number.MAX_SAFE_INTEGER;\n    let maxRectTop = Number.MIN_SAFE_INTEGER;\n\n    const updateRanges = () => {\n      groupRefRect = useRect(groupRef);\n      const rects = itemRefs.value.map(useRect);\n      ranges = [];\n      rects.forEach((rect, index) => {\n        minRectTop = Math.min(rect.top, minRectTop);\n        maxRectTop = Math.max(rect.top, maxRectTop);\n\n        if (props.allowHalf) {\n          ranges.push({\n            score: index + 0.5,\n            left: rect.left,\n            top: rect.top,\n            height: rect.height\n          }, {\n            score: index + 1,\n            left: rect.left + rect.width / 2,\n            top: rect.top,\n            height: rect.height\n          });\n        } else {\n          ranges.push({\n            score: index + 1,\n            left: rect.left,\n            top: rect.top,\n            height: rect.height\n          });\n        }\n      });\n    };\n\n    const getScoreByPosition = (x, y) => {\n      for (let i = ranges.length - 1; i > 0; i--) {\n        if (y >= groupRefRect.top && y <= groupRefRect.bottom) {\n          if (x > ranges[i].left && y >= ranges[i].top && y <= ranges[i].top + ranges[i].height) {\n            return ranges[i].score;\n          }\n        } else {\n          const curTop = y < groupRefRect.top ? minRectTop : maxRectTop;\n\n          if (x > ranges[i].left && ranges[i].top === curTop) {\n            return ranges[i].score;\n          }\n        }\n      }\n\n      return props.allowHalf ? 0.5 : 1;\n    };\n\n    const select = index => {\n      if (!props.disabled && !props.readonly && index !== props.modelValue) {\n        emit(\"update:modelValue\", index);\n        emit(\"change\", index);\n      }\n    };\n\n    const onTouchStart = event => {\n      if (untouchable()) {\n        return;\n      }\n\n      touch.start(event);\n      updateRanges();\n    };\n\n    const onTouchMove = event => {\n      if (untouchable()) {\n        return;\n      }\n\n      touch.move(event);\n\n      if (touch.isHorizontal()) {\n        const {\n          clientX,\n          clientY\n        } = event.touches[0];\n        preventDefault(event);\n        select(getScoreByPosition(clientX, clientY));\n      }\n    };\n\n    const renderStar = (item, index) => {\n      const {\n        icon,\n        size,\n        color,\n        count,\n        gutter,\n        voidIcon,\n        disabled,\n        voidColor,\n        allowHalf,\n        iconPrefix,\n        disabledColor\n      } = props;\n      const score = index + 1;\n      const isFull = item.status === \"full\";\n      const isVoid = item.status === \"void\";\n      const renderHalf = allowHalf && item.value > 0 && item.value < 1;\n      let style;\n\n      if (gutter && score !== +count) {\n        style = {\n          paddingRight: addUnit(gutter)\n        };\n      }\n\n      const onClickItem = event => {\n        updateRanges();\n        select(allowHalf ? getScoreByPosition(event.clientX, event.clientY) : score);\n      };\n\n      return _createVNode(\"div\", {\n        \"key\": index,\n        \"ref\": setItemRefs(index),\n        \"role\": \"radio\",\n        \"style\": style,\n        \"class\": bem(\"item\"),\n        \"tabindex\": disabled ? void 0 : 0,\n        \"aria-setsize\": count,\n        \"aria-posinset\": score,\n        \"aria-checked\": !isVoid,\n        \"onClick\": onClickItem\n      }, [_createVNode(Icon, {\n        \"size\": size,\n        \"name\": isFull ? icon : voidIcon,\n        \"class\": bem(\"icon\", {\n          disabled,\n          full: isFull\n        }),\n        \"color\": disabled ? disabledColor : isFull ? color : voidColor,\n        \"classPrefix\": iconPrefix\n      }, null), renderHalf && _createVNode(Icon, {\n        \"size\": size,\n        \"style\": {\n          width: item.value + \"em\"\n        },\n        \"name\": isVoid ? voidIcon : icon,\n        \"class\": bem(\"icon\", [\"half\", {\n          disabled,\n          full: !isVoid\n        }]),\n        \"color\": disabled ? disabledColor : isVoid ? voidColor : color,\n        \"classPrefix\": iconPrefix\n      }, null)]);\n    };\n\n    useCustomFieldValue(() => props.modelValue);\n    return () => _createVNode(\"div\", {\n      \"ref\": groupRef,\n      \"role\": \"radiogroup\",\n      \"class\": bem({\n        readonly: props.readonly,\n        disabled: props.disabled\n      }),\n      \"tabindex\": props.disabled ? void 0 : 0,\n      \"aria-disabled\": props.disabled,\n      \"aria-readonly\": props.readonly,\n      \"onTouchstart\": onTouchStart,\n      \"onTouchmove\": onTouchMove\n    }, [list.value.map(renderStar)]);\n  }\n\n});\nexport { stdin_default as default };","map":{"version":3,"sources":["G:/VUE_FDS/fluent-vue/node_modules/vant/es/rate/Rate.js"],"names":["createVNode","_createVNode","computed","defineComponent","ref","addUnit","truthProp","numericProp","preventDefault","makeStringProp","makeNumberProp","makeNumericProp","createNamespace","useRect","useCustomFieldValue","useRefs","useTouch","Icon","name","bem","getRateStatus","value","index","allowHalf","readonly","status","cardinal","Math","round","rateProps","size","icon","color","String","count","gutter","Boolean","disabled","voidIcon","voidColor","touchable","iconPrefix","modelValue","disabledColor","stdin_default","props","emits","setup","emit","touch","itemRefs","setItemRefs","groupRef","untouchable","list","Array","fill","map","_","i","ranges","groupRefRect","minRectTop","Number","MAX_SAFE_INTEGER","maxRectTop","MIN_SAFE_INTEGER","updateRanges","rects","forEach","rect","min","top","max","push","score","left","height","width","getScoreByPosition","x","y","length","bottom","curTop","select","onTouchStart","event","start","onTouchMove","move","isHorizontal","clientX","clientY","touches","renderStar","item","isFull","isVoid","renderHalf","style","paddingRight","onClickItem","full","default"],"mappings":"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","sourcesContent":["import { createVNode as _createVNode } from \"vue\";\nimport { computed, defineComponent, ref } from \"vue\";\nimport { addUnit, truthProp, numericProp, preventDefault, makeStringProp, makeNumberProp, makeNumericProp, createNamespace } from \"../utils\";\nimport { useRect, useCustomFieldValue } from \"@vant/use\";\nimport { useRefs } from \"../composables/use-refs\";\nimport { useTouch } from \"../composables/use-touch\";\nimport { Icon } from \"../icon\";\nconst [name, bem] = createNamespace(\"rate\");\nfunction getRateStatus(value, index, allowHalf, readonly) {\n  if (value >= index) {\n    return {\n      status: \"full\",\n      value: 1\n    };\n  }\n  if (value + 0.5 >= index && allowHalf && !readonly) {\n    return {\n      status: \"half\",\n      value: 0.5\n    };\n  }\n  if (value + 1 >= index && allowHalf && readonly) {\n    const cardinal = 10 ** 10;\n    return {\n      status: \"half\",\n      value: Math.round((value - index + 1) * cardinal) / cardinal\n    };\n  }\n  return {\n    status: \"void\",\n    value: 0\n  };\n}\nconst rateProps = {\n  size: numericProp,\n  icon: makeStringProp(\"star\"),\n  color: String,\n  count: makeNumericProp(5),\n  gutter: numericProp,\n  readonly: Boolean,\n  disabled: Boolean,\n  voidIcon: makeStringProp(\"star-o\"),\n  allowHalf: Boolean,\n  voidColor: String,\n  touchable: truthProp,\n  iconPrefix: String,\n  modelValue: makeNumberProp(0),\n  disabledColor: String\n};\nvar stdin_default = defineComponent({\n  name,\n  props: rateProps,\n  emits: [\"change\", \"update:modelValue\"],\n  setup(props, {\n    emit\n  }) {\n    const touch = useTouch();\n    const [itemRefs, setItemRefs] = useRefs();\n    const groupRef = ref();\n    const untouchable = () => props.readonly || props.disabled || !props.touchable;\n    const list = computed(() => Array(+props.count).fill(\"\").map((_, i) => getRateStatus(props.modelValue, i + 1, props.allowHalf, props.readonly)));\n    let ranges;\n    let groupRefRect;\n    let minRectTop = Number.MAX_SAFE_INTEGER;\n    let maxRectTop = Number.MIN_SAFE_INTEGER;\n    const updateRanges = () => {\n      groupRefRect = useRect(groupRef);\n      const rects = itemRefs.value.map(useRect);\n      ranges = [];\n      rects.forEach((rect, index) => {\n        minRectTop = Math.min(rect.top, minRectTop);\n        maxRectTop = Math.max(rect.top, maxRectTop);\n        if (props.allowHalf) {\n          ranges.push({\n            score: index + 0.5,\n            left: rect.left,\n            top: rect.top,\n            height: rect.height\n          }, {\n            score: index + 1,\n            left: rect.left + rect.width / 2,\n            top: rect.top,\n            height: rect.height\n          });\n        } else {\n          ranges.push({\n            score: index + 1,\n            left: rect.left,\n            top: rect.top,\n            height: rect.height\n          });\n        }\n      });\n    };\n    const getScoreByPosition = (x, y) => {\n      for (let i = ranges.length - 1; i > 0; i--) {\n        if (y >= groupRefRect.top && y <= groupRefRect.bottom) {\n          if (x > ranges[i].left && y >= ranges[i].top && y <= ranges[i].top + ranges[i].height) {\n            return ranges[i].score;\n          }\n        } else {\n          const curTop = y < groupRefRect.top ? minRectTop : maxRectTop;\n          if (x > ranges[i].left && ranges[i].top === curTop) {\n            return ranges[i].score;\n          }\n        }\n      }\n      return props.allowHalf ? 0.5 : 1;\n    };\n    const select = (index) => {\n      if (!props.disabled && !props.readonly && index !== props.modelValue) {\n        emit(\"update:modelValue\", index);\n        emit(\"change\", index);\n      }\n    };\n    const onTouchStart = (event) => {\n      if (untouchable()) {\n        return;\n      }\n      touch.start(event);\n      updateRanges();\n    };\n    const onTouchMove = (event) => {\n      if (untouchable()) {\n        return;\n      }\n      touch.move(event);\n      if (touch.isHorizontal()) {\n        const {\n          clientX,\n          clientY\n        } = event.touches[0];\n        preventDefault(event);\n        select(getScoreByPosition(clientX, clientY));\n      }\n    };\n    const renderStar = (item, index) => {\n      const {\n        icon,\n        size,\n        color,\n        count,\n        gutter,\n        voidIcon,\n        disabled,\n        voidColor,\n        allowHalf,\n        iconPrefix,\n        disabledColor\n      } = props;\n      const score = index + 1;\n      const isFull = item.status === \"full\";\n      const isVoid = item.status === \"void\";\n      const renderHalf = allowHalf && item.value > 0 && item.value < 1;\n      let style;\n      if (gutter && score !== +count) {\n        style = {\n          paddingRight: addUnit(gutter)\n        };\n      }\n      const onClickItem = (event) => {\n        updateRanges();\n        select(allowHalf ? getScoreByPosition(event.clientX, event.clientY) : score);\n      };\n      return _createVNode(\"div\", {\n        \"key\": index,\n        \"ref\": setItemRefs(index),\n        \"role\": \"radio\",\n        \"style\": style,\n        \"class\": bem(\"item\"),\n        \"tabindex\": disabled ? void 0 : 0,\n        \"aria-setsize\": count,\n        \"aria-posinset\": score,\n        \"aria-checked\": !isVoid,\n        \"onClick\": onClickItem\n      }, [_createVNode(Icon, {\n        \"size\": size,\n        \"name\": isFull ? icon : voidIcon,\n        \"class\": bem(\"icon\", {\n          disabled,\n          full: isFull\n        }),\n        \"color\": disabled ? disabledColor : isFull ? color : voidColor,\n        \"classPrefix\": iconPrefix\n      }, null), renderHalf && _createVNode(Icon, {\n        \"size\": size,\n        \"style\": {\n          width: item.value + \"em\"\n        },\n        \"name\": isVoid ? voidIcon : icon,\n        \"class\": bem(\"icon\", [\"half\", {\n          disabled,\n          full: !isVoid\n        }]),\n        \"color\": disabled ? disabledColor : isVoid ? voidColor : color,\n        \"classPrefix\": iconPrefix\n      }, null)]);\n    };\n    useCustomFieldValue(() => props.modelValue);\n    return () => _createVNode(\"div\", {\n      \"ref\": groupRef,\n      \"role\": \"radiogroup\",\n      \"class\": bem({\n        readonly: props.readonly,\n        disabled: props.disabled\n      }),\n      \"tabindex\": props.disabled ? void 0 : 0,\n      \"aria-disabled\": props.disabled,\n      \"aria-readonly\": props.readonly,\n      \"onTouchstart\": onTouchStart,\n      \"onTouchmove\": onTouchMove\n    }, [list.value.map(renderStar)]);\n  }\n});\nexport {\n  stdin_default as default\n};\n"]},"metadata":{},"sourceType":"module"}