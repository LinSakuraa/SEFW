{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { defineComponent, provide, ref, inject, getCurrentInstance, onBeforeUnmount } from 'vue';\nimport { beforeNextFrameOnce } from 'seemly';\nimport { on, off } from 'evtd';\nimport { getSlot } from '../../shared/v-node';\nimport { getScrollParent } from './utils';\nconst Binder = defineComponent({\n  name: 'Binder',\n  props: {\n    syncTargetWithParent: Boolean,\n    syncTarget: {\n      type: Boolean,\n      default: true\n    }\n  },\n\n  setup(props) {\n    var _a;\n\n    provide('VBinder', (_a = getCurrentInstance()) === null || _a === void 0 ? void 0 : _a.proxy);\n    const VBinder = inject('VBinder', null);\n    const targetRef = ref(null);\n    /**\n     * If there's no nested vbinder, we can simply set the target ref.\n     *\n     * However, when it comes to:\n     * <VBinder> <- syncTarget = false\n     *\n     *              Should hold target DOM ref, but can't get it directly from\n     *              its VTarget. So if there are nested VBinder, we should:\n     *              1. Stop setting target DOM from level-1 VTarget\n     *              2. Set target DOM from level-2 VTarget\n     *              For (1), we need `syncTarget` to `false`\n     *              For (2), we need to set `syncTargetWithParent` to `true` on\n     *              level-2 VBinder\n     *   <VTarget>\n     *     <VBinder> <- syncTargetWithParent = true\n     *       <VTarget>target</VTarget>\n     *     </VBinder>\n     *     <VFollower>\n     *       content1\n     *     </VFollower>\n     *   </VTarget>\n     *   <VFollower>\n     *     content2\n     *   </VFollower>\n     * </VBinder>\n     */\n\n    const setTargetRef = el => {\n      targetRef.value = el; // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\n      if (VBinder && props.syncTargetWithParent) {\n        VBinder.setTargetRef(el);\n      }\n    }; // scroll related\n\n\n    let scrollableNodes = [];\n\n    const ensureScrollListener = () => {\n      let cursor = targetRef.value;\n\n      while (true) {\n        cursor = getScrollParent(cursor);\n        if (cursor === null) break;\n        scrollableNodes.push(cursor);\n      }\n\n      for (const el of scrollableNodes) {\n        on('scroll', el, onScroll, true);\n      }\n    };\n\n    const removeScrollListeners = () => {\n      for (const el of scrollableNodes) {\n        off('scroll', el, onScroll, true);\n      }\n\n      scrollableNodes = [];\n    };\n\n    const followerScrollListeners = new Set();\n\n    const addScrollListener = listener => {\n      if (followerScrollListeners.size === 0) {\n        ensureScrollListener();\n      }\n\n      if (!followerScrollListeners.has(listener)) {\n        followerScrollListeners.add(listener);\n      }\n    };\n\n    const removeScrollListener = listener => {\n      if (followerScrollListeners.has(listener)) {\n        followerScrollListeners.delete(listener);\n      }\n\n      if (followerScrollListeners.size === 0) {\n        removeScrollListeners();\n      }\n    };\n\n    const onScroll = () => {\n      beforeNextFrameOnce(onScrollRaf);\n    };\n\n    const onScrollRaf = () => {\n      followerScrollListeners.forEach(listener => listener());\n    }; // resize related\n\n\n    const followerResizeListeners = new Set();\n\n    const addResizeListener = listener => {\n      if (followerResizeListeners.size === 0) {\n        on('resize', window, onResize);\n      }\n\n      if (!followerResizeListeners.has(listener)) {\n        followerResizeListeners.add(listener);\n      }\n    };\n\n    const removeResizeListener = listener => {\n      if (followerResizeListeners.has(listener)) {\n        followerResizeListeners.delete(listener);\n      }\n\n      if (followerResizeListeners.size === 0) {\n        off('resize', window, onResize);\n      }\n    };\n\n    const onResize = () => {\n      followerResizeListeners.forEach(listener => listener());\n    };\n\n    onBeforeUnmount(() => {\n      off('resize', window, onResize);\n      removeScrollListeners();\n    });\n    return {\n      targetRef,\n      setTargetRef,\n      addScrollListener,\n      removeScrollListener,\n      addResizeListener,\n      removeResizeListener\n    };\n  },\n\n  render() {\n    return getSlot('binder', this.$slots);\n  }\n\n});\nexport default Binder;","map":{"version":3,"sources":["G:/VUE_FDS/fluent-vue/node_modules/vueuc/es/binder/src/Binder.js"],"names":["defineComponent","provide","ref","inject","getCurrentInstance","onBeforeUnmount","beforeNextFrameOnce","on","off","getSlot","getScrollParent","Binder","name","props","syncTargetWithParent","Boolean","syncTarget","type","default","setup","_a","proxy","VBinder","targetRef","setTargetRef","el","value","scrollableNodes","ensureScrollListener","cursor","push","onScroll","removeScrollListeners","followerScrollListeners","Set","addScrollListener","listener","size","has","add","removeScrollListener","delete","onScrollRaf","forEach","followerResizeListeners","addResizeListener","window","onResize","removeResizeListener","render","$slots"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { defineComponent, provide, ref, inject, getCurrentInstance, onBeforeUnmount } from 'vue';\nimport { beforeNextFrameOnce } from 'seemly';\nimport { on, off } from 'evtd';\nimport { getSlot } from '../../shared/v-node';\nimport { getScrollParent } from './utils';\nconst Binder = defineComponent({\n    name: 'Binder',\n    props: {\n        syncTargetWithParent: Boolean,\n        syncTarget: {\n            type: Boolean,\n            default: true\n        }\n    },\n    setup(props) {\n        var _a;\n        provide('VBinder', (_a = getCurrentInstance()) === null || _a === void 0 ? void 0 : _a.proxy);\n        const VBinder = inject('VBinder', null);\n        const targetRef = ref(null);\n        /**\n         * If there's no nested vbinder, we can simply set the target ref.\n         *\n         * However, when it comes to:\n         * <VBinder> <- syncTarget = false\n         *\n         *              Should hold target DOM ref, but can't get it directly from\n         *              its VTarget. So if there are nested VBinder, we should:\n         *              1. Stop setting target DOM from level-1 VTarget\n         *              2. Set target DOM from level-2 VTarget\n         *              For (1), we need `syncTarget` to `false`\n         *              For (2), we need to set `syncTargetWithParent` to `true` on\n         *              level-2 VBinder\n         *   <VTarget>\n         *     <VBinder> <- syncTargetWithParent = true\n         *       <VTarget>target</VTarget>\n         *     </VBinder>\n         *     <VFollower>\n         *       content1\n         *     </VFollower>\n         *   </VTarget>\n         *   <VFollower>\n         *     content2\n         *   </VFollower>\n         * </VBinder>\n         */\n        const setTargetRef = (el) => {\n            targetRef.value = el;\n            // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n            if (VBinder && props.syncTargetWithParent) {\n                VBinder.setTargetRef(el);\n            }\n        };\n        // scroll related\n        let scrollableNodes = [];\n        const ensureScrollListener = () => {\n            let cursor = targetRef.value;\n            while (true) {\n                cursor = getScrollParent(cursor);\n                if (cursor === null)\n                    break;\n                scrollableNodes.push(cursor);\n            }\n            for (const el of scrollableNodes) {\n                on('scroll', el, onScroll, true);\n            }\n        };\n        const removeScrollListeners = () => {\n            for (const el of scrollableNodes) {\n                off('scroll', el, onScroll, true);\n            }\n            scrollableNodes = [];\n        };\n        const followerScrollListeners = new Set();\n        const addScrollListener = (listener) => {\n            if (followerScrollListeners.size === 0) {\n                ensureScrollListener();\n            }\n            if (!followerScrollListeners.has(listener)) {\n                followerScrollListeners.add(listener);\n            }\n        };\n        const removeScrollListener = (listener) => {\n            if (followerScrollListeners.has(listener)) {\n                followerScrollListeners.delete(listener);\n            }\n            if (followerScrollListeners.size === 0) {\n                removeScrollListeners();\n            }\n        };\n        const onScroll = () => {\n            beforeNextFrameOnce(onScrollRaf);\n        };\n        const onScrollRaf = () => {\n            followerScrollListeners.forEach((listener) => listener());\n        };\n        // resize related\n        const followerResizeListeners = new Set();\n        const addResizeListener = (listener) => {\n            if (followerResizeListeners.size === 0) {\n                on('resize', window, onResize);\n            }\n            if (!followerResizeListeners.has(listener)) {\n                followerResizeListeners.add(listener);\n            }\n        };\n        const removeResizeListener = (listener) => {\n            if (followerResizeListeners.has(listener)) {\n                followerResizeListeners.delete(listener);\n            }\n            if (followerResizeListeners.size === 0) {\n                off('resize', window, onResize);\n            }\n        };\n        const onResize = () => {\n            followerResizeListeners.forEach((listener) => listener());\n        };\n        onBeforeUnmount(() => {\n            off('resize', window, onResize);\n            removeScrollListeners();\n        });\n        return {\n            targetRef,\n            setTargetRef,\n            addScrollListener,\n            removeScrollListener,\n            addResizeListener,\n            removeResizeListener\n        };\n    },\n    render() {\n        return getSlot('binder', this.$slots);\n    }\n});\nexport default Binder;\n"]},"metadata":{},"sourceType":"module"}